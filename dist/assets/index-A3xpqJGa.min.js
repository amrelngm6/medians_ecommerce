var hn=Object.defineProperty;var gn=(i,t,e)=>t in i?hn(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var g=(i,t,e)=>gn(i,typeof t!="symbol"?t+"":t,e);import{b as fn,t as pn,P as C,i as S,B as x,a as L,C as I,g as bn,p as wn,c as Cn,N as vn,A as kn,d as In,E as Tn,S as _n,T as yn,e as F,f as oe,h as K,j as se,k as ie,l as q,m as le,n as Q,o as An,q as Sn,r as Rn,s as xn,u as En,v as Vn,w as gt,x as U,y as Bn,W as xe,z as re,U as ft,D as W,F as pt,G as Ln,H as Fn,I as bt,J as Ee,K as Pn,O as be,Q as wt,R as Ct,V as $,X as j,Y as G,Z as ae,$ as ce,a0 as Hn,a1 as Ve,a2 as vt,a3 as kt,a4 as Un,a5 as On,a6 as Nn,a7 as Ue,a8 as Mn,a9 as Dn,aa as zn,ab as Wn,ac as $n,ad as Kn,ae as Be,af as qn,ag as jn,ah as It,ai as Gn,aj as Tt,ak as Oe,al as me,am as Jn,an as Yn,ao as Zn,ap as Xn}from"./ckeditor5-Cq0vUSMg.min.js";function Qn(i,t,e){var n=i.length;return e=e===void 0?n:e,!t&&e>=n?i:fn(i,t,e)}var eo="\\ud800-\\udfff",to="\\u0300-\\u036f",no="\\ufe20-\\ufe2f",oo="\\u20d0-\\u20ff",so=to+no+oo,io="\\ufe0e\\ufe0f",lo="\\u200d",ro=RegExp("["+lo+eo+so+io+"]");function _t(i){return ro.test(i)}function ao(i){return i.split("")}var yt="\\ud800-\\udfff",co="\\u0300-\\u036f",uo="\\ufe20-\\ufe2f",mo="\\u20d0-\\u20ff",ho=co+uo+mo,go="\\ufe0e\\ufe0f",fo="["+yt+"]",we="["+ho+"]",Ce="\\ud83c[\\udffb-\\udfff]",po="(?:"+we+"|"+Ce+")",At="[^"+yt+"]",St="(?:\\ud83c[\\udde6-\\uddff]){2}",Rt="[\\ud800-\\udbff][\\udc00-\\udfff]",bo="\\u200d",xt=po+"?",Et="["+go+"]?",wo="(?:"+bo+"(?:"+[At,St,Rt].join("|")+")"+Et+xt+")*",Co=Et+xt+wo,vo="(?:"+[At+we+"?",we,St,Rt,fo].join("|")+")",ko=RegExp(Ce+"(?="+Ce+")|"+vo+Co,"g");function Io(i){return i.match(ko)||[]}function To(i){return _t(i)?Io(i):ao(i)}function _o(i){return function(t){t=pn(t);var e=_t(t)?To(t):void 0,n=e?e[0]:t.charAt(0),o=e?Qn(e,1).join(""):t.slice(1);return n[i]()+o}}var yo=_o("toUpperCase");/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Vt extends I{constructor(e,n){super(e);g(this,"attributeKey");this.attributeKey=n}refresh(){const e=this.editor.model,n=e.document;this.value=this._getValueFromFirstAllowedNode(),this.isEnabled=e.schema.checkAttributeInSelection(n.selection,this.attributeKey)}execute(e={}){const n=this.editor.model,s=n.document.selection,l=e.forceValue===void 0?!this.value:e.forceValue;n.change(r=>{if(s.isCollapsed)l?r.setSelectionAttribute(this.attributeKey,!0):r.removeSelectionAttribute(this.attributeKey);else{const a=n.schema.getValidRanges(s.getRanges(),this.attributeKey);for(const c of a)l?r.setAttribute(this.attributeKey,l,c):r.removeAttribute(this.attributeKey,c)}})}_getValueFromFirstAllowedNode(){const e=this.editor.model,n=e.schema,o=e.document.selection;if(o.isCollapsed)return o.hasAttribute(this.attributeKey);for(const s of o.getRanges())for(const l of s.getItems())if(n.checkAttribute(l,this.attributeKey))return l.hasAttribute(this.attributeKey);return!1}}const M="bold";class Ao extends C{static get pluginName(){return"BoldEditing"}init(){const t=this.editor,e=this.editor.t;t.model.schema.extend("$text",{allowAttributes:M}),t.model.schema.setAttributeProperties(M,{isFormatting:!0,copyOnEnter:!0}),t.conversion.attributeToElement({model:M,view:"strong",upcastAlso:["b",n=>{const o=n.getStyle("font-weight");return o&&(o=="bold"||Number(o)>=600)?{name:!0,styles:["font-weight"]}:null}]}),t.commands.add(M,new Vt(t,M)),t.keystrokes.set("CTRL+B",M),t.accessibility.addKeystrokeInfos({keystrokes:[{label:e("Bold text"),keystroke:"CTRL+B"}]})}}function Bt({editor:i,commandName:t,plugin:e,icon:n,label:o,keystroke:s}){return l=>{const r=i.commands.get(t),a=new l(i.locale);return a.set({label:o,icon:n,keystroke:s,isToggleable:!0}),a.bind("isEnabled").to(r,"isEnabled"),a.bind("isOn").to(r,"value"),a instanceof L?a.set({role:"menuitemcheckbox"}):a.set({tooltip:!0}),e.listenTo(a,"execute",()=>{i.execute(t),i.editing.view.focus()}),a}}const he="bold";class So extends C{static get pluginName(){return"BoldUI"}init(){const t=this.editor,e=t.locale.t,n=Bt({editor:t,commandName:he,plugin:this,icon:S.bold,label:e("Bold"),keystroke:"CTRL+B"});t.ui.componentFactory.add(he,()=>n(x)),t.ui.componentFactory.add("menuBar:"+he,()=>n(L))}}class Pl extends C{static get requires(){return[Ao,So]}static get pluginName(){return"Bold"}}const D="italic";class Ro extends C{static get pluginName(){return"ItalicEditing"}init(){const t=this.editor,e=this.editor.t;t.model.schema.extend("$text",{allowAttributes:D}),t.model.schema.setAttributeProperties(D,{isFormatting:!0,copyOnEnter:!0}),t.conversion.attributeToElement({model:D,view:"i",upcastAlso:["em",{styles:{"font-style":"italic"}}]}),t.commands.add(D,new Vt(t,D)),t.keystrokes.set("CTRL+I",D),t.accessibility.addKeystrokeInfos({keystrokes:[{label:e("Italic text"),keystroke:"CTRL+I"}]})}}var xo='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.586 14.633.021.004c-.036.335.095.655.393.962.082.083.173.15.274.201h1.474a.6.6 0 1 1 0 1.2H5.304a.6.6 0 0 1 0-1.2h1.15c.474-.07.809-.182 1.005-.334.157-.122.291-.32.404-.597l2.416-9.55a1.053 1.053 0 0 0-.281-.823 1.12 1.12 0 0 0-.442-.296H8.15a.6.6 0 0 1 0-1.2h6.443a.6.6 0 1 1 0 1.2h-1.195c-.376.056-.65.155-.823.296-.215.175-.423.439-.623.79l-2.366 9.347z"/></svg>';const ge="italic";class Eo extends C{static get pluginName(){return"ItalicUI"}init(){const t=this.editor,e=t.locale.t,n=Bt({editor:t,commandName:ge,plugin:this,icon:xo,keystroke:"CTRL+I",label:e("Italic")});t.ui.componentFactory.add(ge,()=>n(x)),t.ui.componentFactory.add("menuBar:"+ge,()=>n(L))}}class Hl extends C{static get requires(){return[Ro,Eo]}static get pluginName(){return"Italic"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Vo extends I{constructor(t){super(t),this.affectsData=!1}execute(){const t=this.editor.model,e=t.document.selection;let n=t.schema.getLimitElement(e);if(e.containsEntireContent(n)||!Ne(t.schema,n))do if(n=n.parent,!n)return;while(!Ne(t.schema,n));t.change(o=>{o.setSelection(n,"in")})}}function Ne(i,t){return i.isLimit(t)&&(i.checkChild(t,"$text")||i.checkChild(t,"paragraph"))}const Bo=wn("Ctrl+A");class Lo extends C{static get pluginName(){return"SelectAllEditing"}init(){const t=this.editor,e=t.t,o=t.editing.view.document;t.commands.add("selectAll",new Vo(t)),this.listenTo(o,"keydown",(s,l)=>{bn(l)===Bo&&(t.execute("selectAll"),l.preventDefault())}),t.accessibility.addKeystrokeInfos({keystrokes:[{label:e("Select all"),keystroke:"CTRL+A"}]})}}var Fo='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M.75 15.5a.75.75 0 0 1 .75.75V18l.008.09A.5.5 0 0 0 2 18.5h1.75a.75.75 0 1 1 0 1.5H1.5l-.144-.007a1.5 1.5 0 0 1-1.35-1.349L0 18.5v-2.25a.75.75 0 0 1 .75-.75zm18.5 0a.75.75 0 0 1 .75.75v2.25l-.007.144a1.5 1.5 0 0 1-1.349 1.35L18.5 20h-2.25a.75.75 0 1 1 0-1.5H18a.5.5 0 0 0 .492-.41L18.5 18v-1.75a.75.75 0 0 1 .75-.75zm-10.45 3c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm.45-5.5a.75.75 0 1 1 0 1.5h-8.5a.75.75 0 1 1 0-1.5h8.5zM1.3 11c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5H4.75a.75.75 0 1 1 0-1.5h10.5zM1.3 7c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5h-2.5a.75.75 0 1 1 0-1.5h2.5zm-5 0a.75.75 0 1 1 0 1.5h-5.5a.75.75 0 0 1 0-1.5h5.5zm-6.5-5a.75.75 0 0 1 0 1.5H2a.5.5 0 0 0-.492.41L1.5 2v1.75a.75.75 0 0 1-1.5 0V1.5l.007-.144A1.5 1.5 0 0 1 1.356.006L1.5 0h2.25zM18.5 0l.144.007a1.5 1.5 0 0 1 1.35 1.349L20 1.5v2.25a.75.75 0 1 1-1.5 0V2l-.008-.09A.5.5 0 0 0 18 1.5h-1.75a.75.75 0 1 1 0-1.5h2.25zM8.8 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6z"/></svg>';class Po extends C{static get pluginName(){return"SelectAllUI"}init(){const t=this.editor;t.ui.componentFactory.add("selectAll",()=>{const e=this._createButton(x);return e.set({tooltip:!0}),e}),t.ui.componentFactory.add("menuBar:selectAll",()=>this._createButton(L))}_createButton(t){const e=this.editor,n=e.locale,o=e.commands.get("selectAll"),s=new t(e.locale),l=n.t;return s.set({label:l("Select all"),icon:Fo,keystroke:"Ctrl+A"}),s.bind("isEnabled").to(o,"isEnabled"),this.listenTo(s,"execute",()=>{e.execute("selectAll"),e.editing.view.focus()}),s}}class Ho extends C{static get requires(){return[Lo,Po]}static get pluginName(){return"SelectAll"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Lt extends I{constructor(e){super(e);g(this,"_stack",[]);g(this,"_createdBatches",new WeakSet);this.refresh(),this._isEnabledBasedOnSelection=!1,this.listenTo(e.data,"set",(n,o)=>{o[1]={...o[1]};const s=o[1];s.batchType||(s.batchType={isUndoable:!1})},{priority:"high"}),this.listenTo(e.data,"set",(n,o)=>{o[1].batchType.isUndoable||this.clearStack()})}refresh(){this.isEnabled=this._stack.length>0}get createdBatches(){return this._createdBatches}addBatch(e){const n=this.editor.model.document.selection,o={ranges:n.hasOwnRange?Array.from(n.getRanges()):[],isBackward:n.isBackward};this._stack.push({batch:e,selection:o}),this.refresh()}clearStack(){this._stack=[],this.refresh()}_restoreSelection(e,n,o){const s=this.editor.model,l=s.document,r=[],a=e.map(d=>d.getTransformedByOperations(o)),c=a.flat();for(const d of a){const m=d.filter(u=>u.root!=l.graveyard).filter(u=>!Oo(u,c));m.length&&(Uo(m),r.push(m[0]))}r.length&&s.change(d=>{d.setSelection(r,{backward:n})})}_undo(e,n){const o=this.editor.model,s=o.document;this._createdBatches.add(n);const l=e.operations.slice().filter(r=>r.isDocumentOperation);l.reverse();for(const r of l){const a=r.baseVersion+1,c=Array.from(s.history.getOperations(a)),m=Cn([r.getReversed()],c,{useRelations:!0,document:this.editor.model.document,padWithNoOps:!1,forceWeakRemove:!0}).operationsA;for(let u of m){const h=u.affectedSelectable;h&&!o.canEditAt(h)&&(u=new vn(u.baseVersion)),n.addOperation(u),o.applyOperation(u),s.history.setOperationAsUndone(r,u)}}}}function Uo(i){i.sort((t,e)=>t.start.isBefore(e.start)?-1:1);for(let t=1;t<i.length;t++){const n=i[t-1].getJoined(i[t],!0);n&&(t--,i.splice(t,2,n))}}function Oo(i,t){return t.some(e=>e!==i&&e.containsRange(i,!0))}class No extends Lt{execute(t=null){const e=t?this._stack.findIndex(s=>s.batch==t):this._stack.length-1,n=this._stack.splice(e,1)[0],o=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(o,()=>{this._undo(n.batch,o);const s=this.editor.model.document.history.getOperations(n.batch.baseVersion);this._restoreSelection(n.selection.ranges,n.selection.isBackward,s)}),this.fire("revert",n.batch,o),this.refresh()}}class Mo extends Lt{execute(){const t=this._stack.pop(),e=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(e,()=>{const o=t.batch.operations[t.batch.operations.length-1].baseVersion+1,s=this.editor.model.document.history.getOperations(o);this._restoreSelection(t.selection.ranges,t.selection.isBackward,s),this._undo(t.batch,e)}),this.refresh()}}class Do extends C{constructor(){super(...arguments);g(this,"_undoCommand");g(this,"_redoCommand");g(this,"_batchRegistry",new WeakSet)}static get pluginName(){return"UndoEditing"}init(){const e=this.editor,n=e.t;this._undoCommand=new No(e),this._redoCommand=new Mo(e),e.commands.add("undo",this._undoCommand),e.commands.add("redo",this._redoCommand),this.listenTo(e.model,"applyOperation",(o,s)=>{const l=s[0];if(!l.isDocumentOperation)return;const r=l.batch,a=this._redoCommand.createdBatches.has(r),c=this._undoCommand.createdBatches.has(r);this._batchRegistry.has(r)||(this._batchRegistry.add(r),r.isUndoable&&(a?this._undoCommand.addBatch(r):c||(this._undoCommand.addBatch(r),this._redoCommand.clearStack())))},{priority:"highest"}),this.listenTo(this._undoCommand,"revert",(o,s,l)=>{this._redoCommand.addBatch(l)}),e.keystrokes.set("CTRL+Z","undo"),e.keystrokes.set("CTRL+Y","redo"),e.keystrokes.set("CTRL+SHIFT+Z","redo"),e.accessibility.addKeystrokeInfos({keystrokes:[{label:n("Undo"),keystroke:"CTRL+Z"},{label:n("Redo"),keystroke:[["CTRL+Y"],["CTRL+SHIFT+Z"]]}]})}}class zo extends C{static get pluginName(){return"UndoUI"}init(){const t=this.editor,e=t.locale,n=t.t,o=e.uiLanguageDirection=="ltr"?S.undo:S.redo,s=e.uiLanguageDirection=="ltr"?S.redo:S.undo;this._addButtonsToFactory("undo",n("Undo"),"CTRL+Z",o),this._addButtonsToFactory("redo",n("Redo"),"CTRL+Y",s)}_addButtonsToFactory(t,e,n,o){const s=this.editor;s.ui.componentFactory.add(t,()=>{const l=this._createButton(x,t,e,n,o);return l.set({tooltip:!0}),l}),s.ui.componentFactory.add("menuBar:"+t,()=>this._createButton(L,t,e,n,o))}_createButton(t,e,n,o,s){const l=this.editor,r=l.locale,a=l.commands.get(e),c=new t(r);return c.set({label:n,icon:s,keystroke:o}),c.bind("isEnabled").to(a,"isEnabled"),this.listenTo(c,"execute",()=>{l.execute(e),l.editing.view.focus()}),c}}class Wo extends C{static get requires(){return[Do,zo]}static get pluginName(){return"Undo"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ul extends C{static get requires(){return[kn,In,Tn,Ho,_n,yn,Wo]}static get pluginName(){return"Essentials"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class de extends I{constructor(e,n){super(e);g(this,"attributeKey");this.attributeKey=n}refresh(){const e=this.editor.model,n=e.document;this.value=n.selection.getAttribute(this.attributeKey),this.isEnabled=e.schema.checkAttributeInSelection(n.selection,this.attributeKey)}execute(e={}){const n=this.editor.model,s=n.document.selection,l=e.value,r=e.batch,a=c=>{if(s.isCollapsed)l?c.setSelectionAttribute(this.attributeKey,l):c.removeSelectionAttribute(this.attributeKey);else{const d=n.schema.getValidRanges(s.getRanges(),this.attributeKey);for(const m of d)l?c.setAttribute(this.attributeKey,l,m):c.removeAttribute(this.attributeKey,m)}};r?n.enqueueChange(r,c=>{a(c)}):n.change(c=>{a(c)})}}const y="fontSize",A="fontFamily",V="fontColor",B="fontBackgroundColor";function Ft(i,t){const e={model:{key:i,values:[]},view:{},upcastAlso:{}};for(const n of t)e.model.values.push(n.model),e.view[n.model]=n.view,n.upcastAlso&&(e.upcastAlso[n.model]=n.upcastAlso);return e}function Pt(i){return t=>Ko(t.getStyle(i))}function Ht(i){return(t,{writer:e})=>e.createAttributeElement("span",{style:`${i}:${t}`},{priority:7})}function $o({dropdownView:i,colors:t,columns:e,removeButtonLabel:n,colorPickerLabel:o,documentColorsLabel:s,documentColorsCount:l,colorPickerViewConfig:r}){const a=i.locale,c=new gt(a,{colors:t,columns:e,removeButtonLabel:n,colorPickerLabel:o,documentColorsLabel:s,documentColorsCount:l,colorPickerViewConfig:r});return i.colorSelectorView=c,i.panelView.children.add(c),c}function Ko(i){return i.replace(/\s/g,"")}class qo extends de{constructor(t){super(t,A)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ut(i){return i.map(jo).filter(t=>t!==void 0)}function jo(i){if(typeof i=="object")return i;if(i==="default")return{title:"Default",model:void 0};if(typeof i=="string")return Go(i)}function Go(i){const t=i.replace(/"|'/g,"").split(","),e=t[0],n=t.map(Jo).join(", ");return{title:e,model:n,view:{name:"span",styles:{"font-family":n},priority:7}}}function Jo(i){return i=i.trim(),i.indexOf(" ")>0&&(i=`'${i}'`),i}class Yo extends C{static get pluginName(){return"FontFamilyEditing"}constructor(t){super(t),t.config.define(A,{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!1})}init(){const t=this.editor;t.model.schema.extend("$text",{allowAttributes:A}),t.model.schema.setAttributeProperties(A,{isFormatting:!0,copyOnEnter:!0});const e=Ut(t.config.get("fontFamily.options")).filter(o=>o.model),n=Ft(A,e);t.config.get("fontFamily.supportAllValues")?(this._prepareAnyValueConverters(),this._prepareCompatibilityConverter()):t.conversion.attributeToElement(n),t.commands.add(A,new qo(t))}_prepareAnyValueConverters(){const t=this.editor;t.conversion.for("downcast").attributeToElement({model:A,view:(e,{writer:n})=>n.createAttributeElement("span",{style:"font-family:"+e},{priority:7})}),t.conversion.for("upcast").elementToAttribute({model:{key:A,value:e=>e.getStyle("font-family")},view:{name:"span",styles:{"font-family":/.*/}}})}_prepareCompatibilityConverter(){this.editor.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{face:/.*/}},model:{key:A,value:e=>e.getAttribute("face")}})}}var Me='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.03 3h6.149a.75.75 0 1 1 0 1.5h-5.514L11.03 3zm1.27 3h4.879a.75.75 0 1 1 0 1.5h-4.244L12.3 6zm1.27 3h3.609a.75.75 0 1 1 0 1.5h-2.973L13.57 9zm-2.754 2.5L8.038 4.785 5.261 11.5h5.555zm.62 1.5H4.641l-1.666 4.028H1.312l5.789-14h1.875l5.789 14h-1.663L11.436 13z"/></svg>';class Zo extends C{static get pluginName(){return"FontFamilyUI"}init(){const t=this.editor,e=t.t,n=this._getLocalizedOptions(),o=t.commands.get(A),s=e("Font Family"),l=Xo(n,o);t.ui.componentFactory.add(A,r=>{const a=F(r);return oe(a,l,{role:"menu",ariaLabel:s}),a.buttonView.set({label:s,icon:Me,tooltip:!0}),a.extendTemplate({attributes:{class:"ck-font-family-dropdown"}}),a.bind("isEnabled").to(o),this.listenTo(a,"execute",c=>{t.execute(c.source.commandName,{value:c.source.commandParam}),t.editing.view.focus()}),a}),t.ui.componentFactory.add(`menuBar:${A}`,r=>{const a=new K(r);a.buttonView.set({label:s,icon:Me}),a.bind("isEnabled").to(o);const c=new se(r);for(const d of l){const m=new ie(r,a),u=new L(r);u.set({role:"menuitemradio",isToggleable:!0}),u.bind(...Object.keys(d.model)).to(d.model),u.delegate("execute").to(a),u.on("execute",()=>{t.execute(d.model.commandName,{value:d.model.commandParam}),t.editing.view.focus()}),m.children.add(u),c.items.add(m)}return a.panelView.children.add(c),a})}_getLocalizedOptions(){const t=this.editor,e=t.t;return Ut(t.config.get(A).options).map(o=>(o.title==="Default"&&(o.title=e("Default")),o))}}function Xo(i,t){const e=new q;for(const n of i){const o={type:"button",model:new le({commandName:A,commandParam:n.model,label:n.title,role:"menuitemradio",withText:!0})};o.model.bind("isOn").to(t,"value",s=>s===n.model?!0:!s||!n.model?!1:s.split(",")[0].replace(/'/g,"").toLowerCase()===n.model.toLowerCase()),n.view&&typeof n.view!="string"&&n.view.styles&&o.model.set("labelStyle",`font-family: ${n.view.styles["font-family"]}`),e.add(o)}return e}class Qo extends C{static get requires(){return[Yo,Zo]}static get pluginName(){return"FontFamily"}}class es extends de{constructor(t){super(t,y)}}function Le(i){return i.map(t=>ts(t)).filter(t=>t!==void 0)}const De={get tiny(){return{title:"Tiny",model:"tiny",view:{name:"span",classes:"text-tiny",priority:7}}},get small(){return{title:"Small",model:"small",view:{name:"span",classes:"text-small",priority:7}}},get big(){return{title:"Big",model:"big",view:{name:"span",classes:"text-big",priority:7}}},get huge(){return{title:"Huge",model:"huge",view:{name:"span",classes:"text-huge",priority:7}}}};function ts(i){if(typeof i=="number"&&(i=String(i)),typeof i=="object"&&ss(i))return ve(i);const t=os(i);if(t)return ve(t);if(i==="default")return{model:void 0,title:"Default"};if(!is(i))return ns(i)}function ns(i){return typeof i=="string"&&(i={title:i,model:`${parseFloat(i)}px`}),i.view={name:"span",styles:{"font-size":i.model}},ve(i)}function ve(i){return i.view&&typeof i.view!="string"&&!i.view.priority&&(i.view.priority=7),i}function os(i){return typeof i=="string"?De[i]:De[i.model]}function ss(i){return i.title&&i.model&&i.view}function is(i){let t;if(typeof i=="object")if(i.model)t=parseFloat(i.model);else throw new Q("font-size-invalid-definition",null,i);else t=parseFloat(i);return isNaN(t)}const ze=["x-small","x-small","small","medium","large","x-large","xx-large","xxx-large"];class ls extends C{static get pluginName(){return"FontSizeEditing"}constructor(t){super(t),t.config.define(y,{options:["tiny","small","default","big","huge"],supportAllValues:!1})}init(){const t=this.editor;t.model.schema.extend("$text",{allowAttributes:y}),t.model.schema.setAttributeProperties(y,{isFormatting:!0,copyOnEnter:!0});const e=t.config.get("fontSize.supportAllValues"),n=Le(this.editor.config.get("fontSize.options")).filter(s=>s.model),o=Ft(y,n);e?(this._prepareAnyValueConverters(o),this._prepareCompatibilityConverter()):t.conversion.attributeToElement(o),t.commands.add(y,new es(t))}_prepareAnyValueConverters(t){const e=this.editor,n=t.model.values.filter(o=>!An(String(o))&&!Sn(String(o)));if(n.length)throw new Q("font-size-invalid-use-of-named-presets",null,{presets:n});e.conversion.for("downcast").attributeToElement({model:y,view:(o,{writer:s})=>{if(o)return s.createAttributeElement("span",{style:"font-size:"+o},{priority:7})}}),e.conversion.for("upcast").elementToAttribute({model:{key:y,value:o=>o.getStyle("font-size")},view:{name:"span",styles:{"font-size":/.*/}}})}_prepareCompatibilityConverter(){this.editor.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{size:/^[+-]?\d{1,3}$/}},model:{key:y,value:e=>{const n=e.getAttribute("size"),o=n[0]==="-"||n[0]==="+";let s=parseInt(n,10);o&&(s=3+s);const l=ze.length-1,r=Math.min(Math.max(s,0),l);return ze[r]}}})}}var We='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.816 11.5 7.038 4.785 4.261 11.5h5.555zm.62 1.5H3.641l-1.666 4.028H.312l5.789-14h1.875l5.789 14h-1.663L10.436 13zm7.55 2.279.779-.779.707.707-2.265 2.265-2.193-2.265.707-.707.765.765V4.825c0-.042 0-.083.002-.123l-.77.77-.707-.707L17.207 2.5l2.265 2.265-.707.707-.782-.782c.002.043.003.089.003.135v10.454z"/></svg>';class rs extends C{static get pluginName(){return"FontSizeUI"}init(){const t=this.editor,e=t.t,n=this._getLocalizedOptions(),o=t.commands.get(y),s=e("Font Size"),l=as(n,o);t.ui.componentFactory.add(y,r=>{const a=F(r);return oe(a,l,{role:"menu",ariaLabel:s}),a.buttonView.set({label:s,icon:We,tooltip:!0}),a.extendTemplate({attributes:{class:["ck-font-size-dropdown"]}}),a.bind("isEnabled").to(o),this.listenTo(a,"execute",c=>{t.execute(c.source.commandName,{value:c.source.commandParam}),t.editing.view.focus()}),a}),t.ui.componentFactory.add(`menuBar:${y}`,r=>{const a=new K(r);a.buttonView.set({label:s,icon:We}),a.bind("isEnabled").to(o);const c=new se(r);for(const d of l){const m=new ie(r,a),u=new L(r);u.set({role:"menuitemradio",isToggleable:!0}),u.bind(...Object.keys(d.model)).to(d.model),u.delegate("execute").to(a),u.on("execute",()=>{t.execute(d.model.commandName,{value:d.model.commandParam}),t.editing.view.focus()}),m.children.add(u),c.items.add(m)}return a.panelView.children.add(c),a})}_getLocalizedOptions(){const t=this.editor,e=t.t,n={Default:e("Default"),Tiny:e("Tiny"),Small:e("Small"),Big:e("Big"),Huge:e("Huge")};return Le(t.config.get(y).options).map(s=>{const l=n[s.title];return l&&l!=s.title&&(s=Object.assign({},s,{title:l})),s})}}function as(i,t){const e=new q;for(const n of i){const o={type:"button",model:new le({commandName:y,commandParam:n.model,label:n.title,class:"ck-fontsize-option",role:"menuitemradio",withText:!0})};n.view&&typeof n.view!="string"&&(n.view.styles&&o.model.set("labelStyle",`font-size:${n.view.styles["font-size"]}`),n.view.classes&&o.model.set("class",`${o.model.class} ${n.view.classes}`)),o.model.bind("isOn").to(t,"value",s=>s===n.model),e.add(o)}return e}class cs extends C{static get requires(){return[ls,rs]}static get pluginName(){return"FontSize"}normalizeSizeOptions(t){return Le(t)}}class ds extends de{constructor(t){super(t,V)}}class us extends C{static get pluginName(){return"FontColorEditing"}constructor(t){super(t),t.config.define(V,{colors:[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}],columns:5}),t.conversion.for("upcast").elementToAttribute({view:{name:"span",styles:{color:/[\s\S]+/}},model:{key:V,value:Pt("color")}}),t.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{color:/^#?\w+$/}},model:{key:V,value:e=>e.getAttribute("color")}}),t.conversion.for("downcast").attributeToElement({model:V,view:Ht("color")}),t.commands.add(V,new ds(t)),t.model.schema.extend("$text",{allowAttributes:V}),t.model.schema.setAttributeProperties(V,{isFormatting:!0,copyOnEnter:!0})}}class Ot extends C{constructor(e,{commandName:n,componentName:o,icon:s,dropdownLabel:l}){super(e);g(this,"commandName");g(this,"componentName");g(this,"icon");g(this,"dropdownLabel");g(this,"columns");this.commandName=n,this.componentName=o,this.icon=s,this.dropdownLabel=l,this.columns=e.config.get(`${this.componentName}.columns`)}init(){const e=this.editor,n=e.locale,o=n.t,s=e.commands.get(this.commandName),l=e.config.get(this.componentName),r=xn(l.colors),a=En(n,r),c=l.documentColors,d=l.colorPicker!==!1;e.ui.componentFactory.add(this.componentName,m=>{const u=F(m);let h=!1;const f=$o({dropdownView:u,colors:a.map(p=>({label:p.label,color:p.model,options:{hasBorder:p.hasBorder}})),columns:this.columns,removeButtonLabel:o("Remove color"),colorPickerLabel:o("Color picker"),documentColorsLabel:c!==0?o("Document colors"):"",documentColorsCount:c===void 0?this.columns:c,colorPickerViewConfig:d?l.colorPicker||{}:!1});return f.bind("selectedColor").to(s,"value"),u.buttonView.set({label:this.dropdownLabel,icon:this.icon,tooltip:!0}),u.extendTemplate({attributes:{class:"ck-color-ui-dropdown"}}),u.bind("isEnabled").to(s),f.on("execute",(p,w)=>{u.isOpen&&e.execute(this.commandName,{value:w.value,batch:this._undoStepBatch}),w.source!=="colorPicker"&&e.editing.view.focus(),w.source==="colorPickerSaveButton"&&(u.isOpen=!1)}),f.on("colorPicker:show",()=>{this._undoStepBatch=e.model.createBatch()}),f.on("colorPicker:cancel",()=>{this._undoStepBatch.operations.length&&(u.isOpen=!1,e.execute("undo",this._undoStepBatch)),e.editing.view.focus()}),u.on("change:isOpen",(p,w,b)=>{h||(h=!0,u.colorSelectorView.appendUI()),b&&(c!==0&&f.updateDocumentColors(e.model,this.componentName),f.updateSelectedColors(),f.showColorGridsFragment())}),Vn(u,()=>u.colorSelectorView.colorGridsFragmentView.staticColorsGrid.items.find(p=>p.isOn)),u}),e.ui.componentFactory.add(`menuBar:${this.componentName}`,m=>{const u=new K(m);u.buttonView.set({label:this.dropdownLabel,icon:this.icon}),u.bind("isEnabled").to(s);let h=!1;const f=new gt(m,{colors:a.map(p=>({label:p.label,color:p.model,options:{hasBorder:p.hasBorder}})),columns:this.columns,removeButtonLabel:o("Remove color"),colorPickerLabel:o("Color picker"),documentColorsLabel:c!==0?o("Document colors"):"",documentColorsCount:c===void 0?this.columns:c,colorPickerViewConfig:!1});return f.bind("selectedColor").to(s,"value"),f.delegate("execute").to(u),f.on("execute",(p,w)=>{e.execute(this.commandName,{value:w.value,batch:this._undoStepBatch}),e.editing.view.focus()}),u.on("change:isOpen",(p,w,b)=>{h||(h=!0,f.appendUI()),b&&(c!==0&&f.updateDocumentColors(e.model,this.componentName),f.updateSelectedColors(),f.showColorGridsFragment())}),u.panelView.children.add(f),u})}}var ms='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.4 10.3 10 4.5l-2.4 5.8h4.8zm.5 1.2H7.1L5.7 15H4.2l5-12h1.6l5 12h-1.5L13 11.5zm3.1 7H4a1 1 0 0 1 0-2h12a1 1 0 0 1 0 2z"/></svg>';class hs extends Ot{constructor(t){const e=t.locale.t;super(t,{commandName:V,componentName:V,icon:ms,dropdownLabel:e("Font Color")})}static get pluginName(){return"FontColorUI"}}class gs extends C{static get requires(){return[us,hs]}static get pluginName(){return"FontColor"}}class fs extends de{constructor(t){super(t,B)}}class ps extends C{static get pluginName(){return"FontBackgroundColorEditing"}constructor(t){super(t),t.config.define(B,{colors:[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}],columns:5}),t.data.addStyleProcessorRules(Rn),t.conversion.for("upcast").elementToAttribute({view:{name:"span",styles:{"background-color":/[\s\S]+/}},model:{key:B,value:Pt("background-color")}}),t.conversion.for("downcast").attributeToElement({model:B,view:Ht("background-color")}),t.commands.add(B,new fs(t)),t.model.schema.extend("$text",{allowAttributes:B}),t.model.schema.setAttributeProperties(B,{isFormatting:!0,copyOnEnter:!0})}}var bs='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm8.38 9.262H7.62L10 5.506l2.38 5.756zm.532 1.285L14.34 16h1.426L10.804 4H9.196L4.234 16H5.66l1.428-3.453h5.824z"/></svg>';class ws extends Ot{constructor(t){const e=t.locale.t;super(t,{commandName:B,componentName:B,icon:bs,dropdownLabel:e("Font Background Color")})}static get pluginName(){return"FontBackgroundColorUI"}}class Cs extends C{static get requires(){return[ps,ws]}static get pluginName(){return"FontBackgroundColor"}}class Ol extends C{static get requires(){return[Qo,cs,gs,Cs]}static get pluginName(){return"Font"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vs extends I{constructor(t){super(t),this._isEnabledBasedOnSelection=!1}refresh(){const t=this.editor.model,e=t.document,n=U(e.selection.getSelectedBlocks());this.value=!!n&&n.is("element","paragraph"),this.isEnabled=!!n&&$e(n,t.schema)}execute(t={}){const e=this.editor.model,n=e.document,o=t.selection||n.selection;e.canEditAt(o)&&e.change(s=>{const l=o.getSelectedBlocks();for(const r of l)!r.is("element","paragraph")&&$e(r,e.schema)&&s.rename(r,"paragraph")})}}function $e(i,t){return t.checkChild(i.parent,"paragraph")&&!t.isObject(i)}class ks extends I{constructor(t){super(t),this._isEnabledBasedOnSelection=!1}execute(t){const e=this.editor.model,n=t.attributes;let o=t.position;e.canEditAt(o)&&e.change(s=>{if(o=this._findPositionToInsertParagraph(o,s),!o)return;const l=s.createElement("paragraph");n&&e.schema.setAllowedAttributes(l,n,s),e.insertContent(l,o),s.setSelection(l,"in")})}_findPositionToInsertParagraph(t,e){const n=this.editor.model;if(n.schema.checkChild(t,"paragraph"))return t;const o=n.schema.findAllowedParent(t,"paragraph");if(!o)return null;const s=t.parent,l=n.schema.checkChild(s,"$text");return s.isEmpty||l&&t.isAtEnd?n.createPositionAfter(s):!s.isEmpty&&l&&t.isAtStart?n.createPositionBefore(s):e.split(t,o).position}}const ne=class ne extends C{static get pluginName(){return"Paragraph"}init(){const t=this.editor,e=t.model;t.commands.add("paragraph",new vs(t)),t.commands.add("insertParagraph",new ks(t)),e.schema.register("paragraph",{inheritAllFrom:"$block"}),t.conversion.elementToElement({model:"paragraph",view:"p"}),t.conversion.for("upcast").elementToElement({model:(n,{writer:o})=>!ne.paragraphLikeElements.has(n.name)||n.isEmpty?null:o.createElement("paragraph"),view:/.+/,converterPriority:"low"})}};g(ne,"paragraphLikeElements",new Set(["blockquote","dd","div","dt","h1","h2","h3","h4","h5","h6","li","p","td","th"]));let ke=ne;/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Is extends I{constructor(e,n){super(e);g(this,"modelElements");this.modelElements=n}refresh(){const e=U(this.editor.model.document.selection.getSelectedBlocks());this.value=!!e&&this.modelElements.includes(e.name)&&e.name,this.isEnabled=!!e&&this.modelElements.some(n=>Ke(e,n,this.editor.model.schema))}execute(e){const n=this.editor.model,o=n.document,s=e.value;n.change(l=>{const r=Array.from(o.selection.getSelectedBlocks()).filter(a=>Ke(a,s,n.schema));for(const a of r)a.is("element",s)||l.rename(a,s)})}}function Ke(i,t,e){return e.checkChild(i.parent,t)&&!e.isObject(i)}const qe="paragraph";class Ts extends C{static get pluginName(){return"HeadingEditing"}constructor(t){super(t),t.config.define("heading",{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h4",title:"Heading 3",class:"ck-heading_heading3"}]})}static get requires(){return[ke]}init(){const t=this.editor,e=t.config.get("heading.options"),n=[];for(const o of e)o.model!=="paragraph"&&(t.model.schema.register(o.model,{inheritAllFrom:"$block"}),t.conversion.elementToElement(o),n.push(o.model));this._addDefaultH1Conversion(t),t.commands.add("heading",new Is(t,n))}afterInit(){const t=this.editor,e=t.commands.get("enter"),n=t.config.get("heading.options");e&&this.listenTo(e,"afterExecute",(o,s)=>{const l=t.model.document.selection.getFirstPosition().parent;n.some(a=>l.is("element",a.model))&&!l.is("element",qe)&&l.childCount===0&&s.writer.rename(l,qe)})}_addDefaultH1Conversion(t){t.conversion.for("upcast").elementToElement({model:"heading1",view:"h1",converterPriority:Bn.low+1})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function _s(i){const t=i.t,e={Paragraph:t("Paragraph"),"Heading 1":t("Heading 1"),"Heading 2":t("Heading 2"),"Heading 3":t("Heading 3"),"Heading 4":t("Heading 4"),"Heading 5":t("Heading 5"),"Heading 6":t("Heading 6")};return i.config.get("heading.options").map(n=>{const o=e[n.title];return o&&o!=n.title&&(n.title=o),n})}class ys extends C{static get pluginName(){return"HeadingUI"}init(){const t=this.editor,e=t.t,n=_s(t),o=e("Choose heading"),s=e("Heading");t.ui.componentFactory.add("heading",l=>{const r={},a=new q,c=t.commands.get("heading"),d=t.commands.get("paragraph"),m=[c];for(const h of n){const f={type:"button",model:new le({label:h.title,class:h.class,role:"menuitemradio",withText:!0})};h.model==="paragraph"?(f.model.bind("isOn").to(d,"value"),f.model.set("commandName","paragraph"),m.push(d)):(f.model.bind("isOn").to(c,"value",p=>p===h.model),f.model.set({commandName:"heading",commandValue:h.model})),a.add(f),r[h.model]=h.title}const u=F(l);return oe(u,a,{ariaLabel:s,role:"menu"}),u.buttonView.set({ariaLabel:s,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:s}),u.extendTemplate({attributes:{class:["ck-heading-dropdown"]}}),u.bind("isEnabled").toMany(m,"isEnabled",(...h)=>h.some(f=>f)),u.buttonView.bind("label").to(c,"value",d,"value",(h,f)=>{const p=f?"paragraph":h;return typeof p=="boolean"||!r[p]?o:r[p]}),u.buttonView.bind("ariaLabel").to(c,"value",d,"value",(h,f)=>{const p=f?"paragraph":h;return typeof p=="boolean"||!r[p]?s:`${r[p]}, ${s}`}),this.listenTo(u,"execute",h=>{const{commandName:f,commandValue:p}=h.source;t.execute(f,p?{value:p}:void 0),t.editing.view.focus()}),u}),t.ui.componentFactory.add("menuBar:heading",l=>{const r=new K(l),a=t.commands.get("heading"),c=t.commands.get("paragraph"),d=[a],m=new se(l);r.set({class:"ck-heading-dropdown"}),m.set({ariaLabel:e("Heading"),role:"menu"}),r.buttonView.set({label:e("Heading")}),r.panelView.children.add(m);for(const u of n){const h=new ie(l,r),f=new L(l);h.children.add(f),m.items.add(h),f.set({isToggleable:!0,label:u.title,role:"menuitemradio",class:u.class}),f.delegate("execute").to(r),f.on("execute",()=>{const p=u.model==="paragraph"?"paragraph":"heading";t.execute(p,{value:u.model}),t.editing.view.focus()}),u.model==="paragraph"?(f.bind("isOn").to(c,"value"),d.push(c)):f.bind("isOn").to(a,"value",p=>p===u.model)}return r.bind("isEnabled").toMany(d,"isEnabled",(...u)=>u.some(h=>h)),r})}}class Nl extends C{static get requires(){return[Ts,ys]}static get pluginName(){return"Heading"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function As(i){return i.createContainerElement("span",{class:"image-inline"},i.createEmptyElement("img"))}function je(i){return i.createContainerElement("figure",{class:"image"},[i.createEmptyElement("img"),i.createSlot("children")])}function Nt(i,t){const e=i.plugins.get("ImageUtils"),n=i.plugins.has("ImageInlineEditing")&&i.plugins.has("ImageBlockEditing");return s=>e.isInlineImageView(s)?n&&(s.getStyle("display")=="block"||s.findAncestor(e.isBlockImageView)?"imageBlock":"imageInline")!==t?null:o(s):null;function o(s){const l={name:!0};return s.hasAttribute("src")&&(l.attributes=["src"]),l}}function Fe(i,t){const e=U(t.getSelectedBlocks());return!e||i.isObject(e)||e.isEmpty&&e.name!="listItem"?"imageBlock":"imageInline"}function ee(i){return i&&i.endsWith("px")?parseInt(i):null}function Ge(i){const t=ee(i.getStyle("width")),e=ee(i.getStyle("height"));return!!(t&&e)}const Ss=/^(image|image-inline)$/;class O extends C{constructor(){super(...arguments);g(this,"_domEmitter",new(Ln()))}static get pluginName(){return"ImageUtils"}isImage(e){return this.isInlineImage(e)||this.isBlockImage(e)}isInlineImageView(e){return!!e&&e.is("element","img")}isBlockImageView(e){return!!e&&e.is("element","figure")&&e.hasClass("image")}insertImage(e={},n=null,o=null,s={}){const l=this.editor,r=l.model,a=r.document.selection,c=Mt(l,n||a,o);e={...Object.fromEntries(a.getAttributes()),...e};for(const d in e)r.schema.checkAttribute(c,d)||delete e[d];return r.change(d=>{const{setImageSizes:m=!0}=s,u=d.createElement(c,e);return r.insertObject(u,n,null,{setSelection:"on",findOptimalPosition:!n&&c!="imageInline"?"auto":void 0}),u.parent?(m&&this.setImageNaturalSizeAttributes(u),u):null})}setImageNaturalSizeAttributes(e){const n=e.getAttribute("src");n&&(e.getAttribute("width")||e.getAttribute("height")||this.editor.model.change(o=>{const s=new Fn.window.Image;this._domEmitter.listenTo(s,"load",()=>{!e.getAttribute("width")&&!e.getAttribute("height")&&this.editor.model.enqueueChange(o.batch,l=>{l.setAttribute("width",s.naturalWidth,e),l.setAttribute("height",s.naturalHeight,e)}),this._domEmitter.stopListening(s,"load")}),s.src=n}))}getClosestSelectedImageWidget(e){const n=e.getFirstPosition();if(!n)return null;const o=e.getSelectedElement();if(o&&this.isImageWidget(o))return o;let s=n.parent;for(;s;){if(s.is("element")&&this.isImageWidget(s))return s;s=s.parent}return null}getClosestSelectedImageElement(e){const n=e.getSelectedElement();return this.isImage(n)?n:e.getFirstPosition().findAncestor("imageBlock")}getImageWidgetFromImageView(e){return e.findAncestor({classes:Ss})}isImageAllowed(){const n=this.editor.model.document.selection;return Rs(this.editor,n)&&xs(n)}toImageWidget(e,n,o){return n.setCustomProperty("image",!0,e),bt(e,n,{label:()=>{const r=this.findViewImgElement(e).getAttribute("alt");return r?`${r} ${o}`:o}})}isImageWidget(e){return!!e.getCustomProperty("image")&&Ee(e)}isBlockImage(e){return!!e&&e.is("element","imageBlock")}isInlineImage(e){return!!e&&e.is("element","imageInline")}findViewImgElement(e){if(this.isInlineImageView(e))return e;const n=this.editor.editing.view;for(const{item:o}of n.createRangeIn(e))if(this.isInlineImageView(o))return o}destroy(){return this._domEmitter.stopListening(),super.destroy()}}function Rs(i,t){if(Mt(i,t,null)=="imageBlock"){const n=Es(t,i.model);if(i.model.schema.checkChild(n,"imageBlock"))return!0}else if(i.model.schema.checkChild(t.focus,"imageInline"))return!0;return!1}function xs(i){return[...i.focus.getAncestors()].every(t=>!t.is("element","imageBlock"))}function Es(i,t){const n=Pn(i,t).start.parent;return n.isEmpty&&!n.is("element","$root")?n.parent:n}function Mt(i,t,e){const n=i.model.schema,o=i.config.get("image.insert.type");return i.plugins.has("ImageBlockEditing")?i.plugins.has("ImageInlineEditing")?e||(o==="inline"?"imageInline":o!=="auto"?"imageBlock":t.is("selection")?Fe(n,t):n.checkChild(t,"imageInline")?"imageInline":"imageBlock"):"imageBlock":"imageInline"}class Vs extends I{refresh(){const n=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!n,this.isEnabled&&n.hasAttribute("alt")?this.value=n.getAttribute("alt"):this.value=!1}execute(t){const e=this.editor,n=e.plugins.get("ImageUtils"),o=e.model,s=n.getClosestSelectedImageElement(o.document.selection);o.change(l=>{l.setAttribute("alt",t.newValue,s)})}}class Bs extends C{static get requires(){return[O]}static get pluginName(){return"ImageTextAlternativeEditing"}init(){this.editor.commands.add("imageTextAlternative",new Vs(this.editor))}}class Ls extends ${constructor(e){super(e);g(this,"focusTracker");g(this,"keystrokes");g(this,"labeledInput");g(this,"saveButtonView");g(this,"cancelButtonView");g(this,"_focusables");g(this,"_focusCycler");const n=this.locale.t;this.focusTracker=new j,this.keystrokes=new G,this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(n("Save"),S.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(n("Cancel"),S.cancel,"ck-button-cancel","cancel"),this._focusables=new ae,this._focusCycler=new ce({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-text-alternative-form","ck-responsive-form"],tabindex:"-1"},children:[this.labeledInput,this.saveButtonView,this.cancelButtonView]})}render(){super.render(),this.keystrokes.listenTo(this.element),Ve({view:this}),[this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(e,n,o,s){const l=new x(this.locale);return l.set({label:e,icon:n,tooltip:!0}),l.extendTemplate({attributes:{class:o}}),s&&l.delegate("execute").to(this,s),l}_createLabeledInputView(){const e=this.locale.t,n=new vt(this.locale,kt);return n.label=e("Text alternative"),n}}function Fs(i){const t=i.plugins.get("ContextualBalloon");if(i.plugins.get("ImageUtils").getClosestSelectedImageWidget(i.editing.view.document.selection)){const n=Dt(i);t.updatePosition(n)}}function Dt(i){const t=i.editing.view,e=Nn.defaultPositions,n=i.plugins.get("ImageUtils");return{target:t.domConverter.mapViewToDom(n.getClosestSelectedImageWidget(t.document.selection)),positions:[e.northArrowSouth,e.northArrowSouthWest,e.northArrowSouthEast,e.southArrowNorth,e.southArrowNorthWest,e.southArrowNorthEast,e.viewportStickyNorth]}}class Ps extends C{constructor(){super(...arguments);g(this,"_balloon");g(this,"_form")}static get requires(){return[be]}static get pluginName(){return"ImageTextAlternativeUI"}init(){this._createButton()}destroy(){super.destroy(),this._form&&this._form.destroy()}_createButton(){const e=this.editor,n=e.t;e.ui.componentFactory.add("imageTextAlternative",o=>{const s=e.commands.get("imageTextAlternative"),l=new x(o);return l.set({label:n("Change image text alternative"),icon:S.textAlternative,tooltip:!0}),l.bind("isEnabled").to(s,"isEnabled"),l.bind("isOn").to(s,"value",r=>!!r),this.listenTo(l,"execute",()=>{this._showForm()}),l})}_createForm(){const e=this.editor,o=e.editing.view.document,s=e.plugins.get("ImageUtils");this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new(wt(Ls))(e.locale),this._form.render(),this.listenTo(this._form,"submit",()=>{e.execute("imageTextAlternative",{newValue:this._form.labeledInput.fieldView.element.value}),this._hideForm(!0)}),this.listenTo(this._form,"cancel",()=>{this._hideForm(!0)}),this._form.keystrokes.set("Esc",(l,r)=>{this._hideForm(!0),r()}),this.listenTo(e.ui,"update",()=>{s.getClosestSelectedImageWidget(o.selection)?this._isVisible&&Fs(e):this._hideForm(!0)}),Ct({emitter:this._form,activator:()=>this._isVisible,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(){if(this._isVisible)return;this._form||this._createForm();const e=this.editor,n=e.commands.get("imageTextAlternative"),o=this._form.labeledInput;this._form.disableCssTransitions(),this._isInBalloon||this._balloon.add({view:this._form,position:Dt(e)}),o.fieldView.value=o.fieldView.element.value=n.value||"",this._form.labeledInput.fieldView.select(),this._form.enableCssTransitions()}_hideForm(e=!1){this._isInBalloon&&(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),e&&this.editor.editing.view.focus())}get _isVisible(){return!!this._balloon&&this._balloon.visibleView===this._form}get _isInBalloon(){return!!this._balloon&&this._balloon.hasView(this._form)}}class zt extends C{static get requires(){return[Bs,Ps]}static get pluginName(){return"ImageTextAlternative"}}function Hs(i){const t=(e,n,o)=>{if(!o.consumable.test(n.viewItem,{name:!0,classes:"image"}))return;const s=i.findViewImgElement(n.viewItem);if(!s||!o.consumable.test(s,{name:!0}))return;o.consumable.consume(n.viewItem,{name:!0,classes:"image"});const l=o.convertItem(s,n.modelCursor),r=U(l.modelRange.getItems());if(!r){o.consumable.revert(n.viewItem,{name:!0,classes:"image"});return}o.convertChildren(n.viewItem,r),o.updateConversionResult(r,n)};return e=>{e.on("element:figure",t)}}function Wt(i,t){const e=(n,o,s)=>{if(!s.consumable.consume(o.item,n.name))return;const l=s.writer,r=s.mapper.toViewElement(o.item),a=i.findViewImgElement(r);o.attributeNewValue===null?(l.removeAttribute("srcset",a),l.removeAttribute("sizes",a)):o.attributeNewValue&&(l.setAttribute("srcset",o.attributeNewValue,a),l.setAttribute("sizes","100vw",a))};return n=>{n.on(`attribute:srcset:${t}`,e)}}function te(i,t,e){const n=(o,s,l)=>{if(!l.consumable.consume(s.item,o.name))return;const r=l.writer,a=l.mapper.toViewElement(s.item),c=i.findViewImgElement(a);r.setAttribute(s.attributeKey,s.attributeNewValue||"",c)};return o=>{o.on(`attribute:${e}:${t}`,n)}}class $t extends Un{observe(t){this.listenTo(t,"load",(e,n)=>{const o=n.target;this.checkShouldIgnoreEventFromTarget(o)||o.tagName=="IMG"&&this._fireEvents(n)},{useCapture:!0})}stopObserving(t){this.stopListening(t)}_fireEvents(t){this.isEnabled&&(this.document.fire("layoutChanged"),this.document.fire("imageLoaded",t))}}class Us extends I{constructor(t){super(t);const e=t.config.get("image.insert.type");t.plugins.has("ImageBlockEditing")||e==="block"&&W("image-block-plugin-required"),t.plugins.has("ImageInlineEditing")||e==="inline"&&W("image-inline-plugin-required")}refresh(){const t=this.editor.plugins.get("ImageUtils");this.isEnabled=t.isImageAllowed()}execute(t){const e=On(t.source),n=this.editor.model.document.selection,o=this.editor.plugins.get("ImageUtils"),s=Object.fromEntries(n.getAttributes());e.forEach((l,r)=>{const a=n.getSelectedElement();if(typeof l=="string"&&(l={src:l}),r&&a&&o.isImage(a)){const c=this.editor.model.createPositionAfter(a);o.insertImage({...l,...s},c)}else o.insertImage({...l,...s})})}}class Os extends I{constructor(t){super(t),this.decorate("cleanupImage")}refresh(){const e=this.editor.plugins.get("ImageUtils"),n=this.editor.model.document.selection.getSelectedElement();this.isEnabled=e.isImage(n),this.value=this.isEnabled?n.getAttribute("src"):null}execute(t){const e=this.editor.model.document.selection.getSelectedElement(),n=this.editor.plugins.get("ImageUtils");this.editor.model.change(o=>{o.setAttribute("src",t.source,e),this.cleanupImage(o,e),n.setImageNaturalSizeAttributes(e)})}cleanupImage(t,e){t.removeAttribute("srcset",e),t.removeAttribute("sizes",e),t.removeAttribute("sources",e),t.removeAttribute("width",e),t.removeAttribute("height",e),t.removeAttribute("alt",e)}}class Kt extends C{static get requires(){return[O]}static get pluginName(){return"ImageEditing"}init(){const t=this.editor,e=t.conversion;t.editing.view.addObserver($t),e.for("upcast").attributeToAttribute({view:{name:"img",key:"alt"},model:"alt"}).attributeToAttribute({view:{name:"img",key:"srcset"},model:"srcset"});const n=new Us(t),o=new Os(t);t.commands.add("insertImage",n),t.commands.add("replaceImageSource",o),t.commands.add("imageInsert",n)}}class qt extends C{static get requires(){return[O]}static get pluginName(){return"ImageSizeAttributes"}afterInit(){this._registerSchema(),this._registerConverters("imageBlock"),this._registerConverters("imageInline")}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:["width","height"]}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:["width","height"]})}_registerConverters(t){const e=this.editor,n=e.plugins.get("ImageUtils"),o=t==="imageBlock"?"figure":"img";e.conversion.for("upcast").attributeToAttribute({view:{name:o,styles:{width:/.+/}},model:{key:"width",value:l=>Ge(l)?ee(l.getStyle("width")):null}}).attributeToAttribute({view:{name:o,key:"width"},model:"width"}).attributeToAttribute({view:{name:o,styles:{height:/.+/}},model:{key:"height",value:l=>Ge(l)?ee(l.getStyle("height")):null}}).attributeToAttribute({view:{name:o,key:"height"},model:"height"}),e.conversion.for("editingDowncast").add(l=>{s(l,"width","width",!0),s(l,"height","height",!0)}),e.conversion.for("dataDowncast").add(l=>{s(l,"width","width",!1),s(l,"height","height",!1)});function s(l,r,a,c){l.on(`attribute:${r}:${t}`,(d,m,u)=>{if(!u.consumable.consume(m.item,d.name))return;const h=u.writer,f=u.mapper.toViewElement(m.item),p=n.findViewImgElement(f);if(m.attributeNewValue!==null?h.setAttribute(a,m.attributeNewValue,p):h.removeAttribute(a,p),m.item.hasAttribute("sources"))return;const w=m.item.hasAttribute("resizedWidth");if(t==="imageInline"&&!w&&!c)return;const b=m.item.getAttribute("width"),v=m.item.getAttribute("height");b&&v&&h.setStyle("aspect-ratio",`${b}/${v}`,p)})}}}class jt extends I{constructor(e,n){super(e);g(this,"_modelElementName");this._modelElementName=n}refresh(){const n=this.editor.plugins.get("ImageUtils"),o=n.getClosestSelectedImageElement(this.editor.model.document.selection);this._modelElementName==="imageBlock"?this.isEnabled=n.isInlineImage(o):this.isEnabled=n.isBlockImage(o)}execute(e={}){const n=this.editor,o=this.editor.model,s=n.plugins.get("ImageUtils"),l=s.getClosestSelectedImageElement(o.document.selection),r=Object.fromEntries(l.getAttributes());return!r.src&&!r.uploadId?null:o.change(a=>{const{setImageSizes:c=!0}=e,d=Array.from(o.markers).filter(h=>h.getRange().containsItem(l)),m=s.insertImage(r,o.createSelection(l,"on"),this._modelElementName,{setImageSizes:c});if(!m)return null;const u=a.createRangeOn(m);for(const h of d){const f=h.getRange(),p=f.root.rootName!="$graveyard"?f.getJoined(u,!0):u;a.updateMarker(h,{range:p})}return{oldElement:l,newElement:m}})}}class Gt extends C{static get requires(){return[O]}static get pluginName(){return"ImagePlaceholder"}afterInit(){this._setupSchema(),this._setupConversion(),this._setupLoadListener()}_setupSchema(){const t=this.editor.model.schema;t.isRegistered("imageBlock")&&t.extend("imageBlock",{allowAttributes:["placeholder"]}),t.isRegistered("imageInline")&&t.extend("imageInline",{allowAttributes:["placeholder"]})}_setupConversion(){const t=this.editor,e=t.conversion,n=t.plugins.get("ImageUtils");e.for("editingDowncast").add(o=>{o.on("attribute:placeholder",(s,l,r)=>{if(!r.consumable.test(l.item,s.name)||!l.item.is("element","imageBlock")&&!l.item.is("element","imageInline"))return;r.consumable.consume(l.item,s.name);const a=r.writer,c=r.mapper.toViewElement(l.item),d=n.findViewImgElement(c);l.attributeNewValue?(a.addClass("image_placeholder",d),a.setStyle("background-image",`url(${l.attributeNewValue})`,d),a.setCustomProperty("editingPipeline:doNotReuseOnce",!0,d)):(a.removeClass("image_placeholder",d),a.removeStyle("background-image",d))})})}_setupLoadListener(){const t=this.editor,e=t.model,n=t.editing,o=n.view,s=t.plugins.get("ImageUtils");o.addObserver($t),this.listenTo(o.document,"imageLoaded",(l,r)=>{const a=o.domConverter.mapDomToView(r.target);if(!a)return;const c=s.getImageWidgetFromImageView(a);if(!c)return;const d=n.mapper.toModelElement(c);!d||!d.hasAttribute("placeholder")||e.enqueueChange({isUndoable:!1},m=>{m.removeAttribute("placeholder",d)})})}}class Ns extends C{static get requires(){return[Kt,qt,O,Gt,re]}static get pluginName(){return"ImageBlockEditing"}init(){const t=this.editor;t.model.schema.register("imageBlock",{inheritAllFrom:"$blockObject",allowAttributes:["alt","src","srcset"]}),this._setupConversion(),t.plugins.has("ImageInlineEditing")&&(t.commands.add("imageTypeBlock",new jt(this.editor,"imageBlock")),this._setupClipboardIntegration())}_setupConversion(){const t=this.editor,e=t.t,n=t.conversion,o=t.plugins.get("ImageUtils");n.for("dataDowncast").elementToStructure({model:"imageBlock",view:(s,{writer:l})=>je(l)}),n.for("editingDowncast").elementToStructure({model:"imageBlock",view:(s,{writer:l})=>o.toImageWidget(je(l),l,e("image widget"))}),n.for("downcast").add(te(o,"imageBlock","src")).add(te(o,"imageBlock","alt")).add(Wt(o,"imageBlock")),n.for("upcast").elementToElement({view:Nt(t,"imageBlock"),model:(s,{writer:l})=>l.createElement("imageBlock",s.hasAttribute("src")?{src:s.getAttribute("src")}:void 0)}).add(Hs(o))}_setupClipboardIntegration(){const t=this.editor,e=t.model,n=t.editing.view,o=t.plugins.get("ImageUtils"),s=t.plugins.get("ClipboardPipeline");this.listenTo(s,"inputTransformation",(l,r)=>{const a=Array.from(r.content.getChildren());let c;if(!a.every(o.isInlineImageView))return;r.targetRanges?c=t.editing.mapper.toModelRange(r.targetRanges[0]):c=e.document.selection.getFirstRange();const d=e.createSelection(c);if(Fe(e.schema,d)==="imageBlock"){const m=new ft(n.document),u=a.map(h=>m.createElement("figure",{class:"image"},h));r.content=m.createDocumentFragment(u)}}),this.listenTo(s,"contentInsertion",(l,r)=>{r.method==="paste"&&e.change(a=>{const c=a.createRangeIn(r.content);for(const d of c.getItems())d.is("element","imageBlock")&&o.setImageNaturalSizeAttributes(d)})})}}class Ms extends ${constructor(e,n=[]){super(e);g(this,"focusTracker");g(this,"keystrokes");g(this,"_focusables");g(this,"_focusCycler");g(this,"children");this.focusTracker=new j,this.keystrokes=new G,this._focusables=new ae,this.children=this.createCollection(),this._focusCycler=new ce({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});for(const o of n)this.children.add(o),this._focusables.add(o),o instanceof Hn&&this._focusables.addMany(o.children);this.setTemplate({tag:"form",attributes:{class:["ck","ck-image-insert-form"],tabindex:-1},children:this.children})}render(){super.render(),Ve({view:this});for(const n of this._focusables)this.focusTracker.add(n.element);this.keystrokes.listenTo(this.element);const e=n=>n.stopPropagation();this.keystrokes.set("arrowright",e),this.keystrokes.set("arrowleft",e),this.keystrokes.set("arrowup",e),this.keystrokes.set("arrowdown",e)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}}class Jt extends C{constructor(e){super(e);g(this,"dropdownView");g(this,"_integrations",new Map);e.config.define("image.insert.integrations",["upload","assetManager","url"])}static get pluginName(){return"ImageInsertUI"}static get requires(){return[O]}init(){const e=this.editor,n=e.model.document.selection,o=e.plugins.get("ImageUtils");this.set("isImageSelected",!1),this.listenTo(e.model.document,"change",()=>{this.isImageSelected=o.isImage(n.getSelectedElement())});const s=r=>this._createToolbarComponent(r),l=r=>this._createMenuBarComponent(r);e.ui.componentFactory.add("insertImage",s),e.ui.componentFactory.add("imageInsert",s),e.ui.componentFactory.add("menuBar:insertImage",l)}registerIntegration({name:e,observable:n,buttonViewCreator:o,formViewCreator:s,menuBarButtonViewCreator:l,requiresForm:r=!1}){this._integrations.has(e)&&W("image-insert-integration-exists",{name:e}),this._integrations.set(e,{observable:n,buttonViewCreator:o,menuBarButtonViewCreator:l,formViewCreator:s,requiresForm:r})}_createToolbarComponent(e){const n=this.editor,o=e.t,s=this._prepareIntegrations();if(!s.length)return null;let l;const r=s[0];if(s.length==1){if(!r.requiresForm)return r.buttonViewCreator(!0);l=r.buttonViewCreator(!0)}else{const d=r.buttonViewCreator(!1);l=new pt(e,d),l.tooltip=!0,l.bind("label").to(this,"isImageSelected",m=>o(m?"Replace image":"Insert image"))}const a=this.dropdownView=F(e,l),c=s.map(({observable:d})=>typeof d=="function"?d():d);return a.bind("isEnabled").toMany(c,"isEnabled",(...d)=>d.some(m=>m)),a.once("change:isOpen",()=>{const d=s.map(({formViewCreator:u})=>u(s.length==1)),m=new Ms(n.locale,d);a.panelView.children.add(m)}),a}_createMenuBarComponent(e){const n=e.t,o=this._prepareIntegrations();if(!o.length)return null;let s;const l=o[0];if(o.length==1)s=l.menuBarButtonViewCreator(!0);else{s=new K(e);const r=new se(e);s.panelView.children.add(r),s.buttonView.set({icon:S.image,label:n("Image")});for(const a of o){const c=new ie(e,s),d=a.menuBarButtonViewCreator(!1);c.children.add(d),r.items.add(c)}}return s}_prepareIntegrations(){const n=this.editor.config.get("image.insert.integrations"),o=[];if(!n.length)return W("image-insert-integrations-not-specified"),o;for(const s of n){if(!this._integrations.has(s)){["upload","assetManager","url"].includes(s)||W("image-insert-unknown-integration",{item:s});continue}o.push(this._integrations.get(s))}return o.length||W("image-insert-integrations-not-registered"),o}}class Ds extends C{static get requires(){return[Ns,xe,zt,Jt]}static get pluginName(){return"ImageBlock"}}class zs extends C{static get requires(){return[Kt,qt,O,Gt,re]}static get pluginName(){return"ImageInlineEditing"}init(){const t=this.editor;t.model.schema.register("imageInline",{inheritAllFrom:"$inlineObject",allowAttributes:["alt","src","srcset"],disallowIn:["caption"]}),this._setupConversion(),t.plugins.has("ImageBlockEditing")&&(t.commands.add("imageTypeInline",new jt(this.editor,"imageInline")),this._setupClipboardIntegration())}_setupConversion(){const t=this.editor,e=t.t,n=t.conversion,o=t.plugins.get("ImageUtils");n.for("dataDowncast").elementToElement({model:"imageInline",view:(s,{writer:l})=>l.createEmptyElement("img")}),n.for("editingDowncast").elementToStructure({model:"imageInline",view:(s,{writer:l})=>o.toImageWidget(As(l),l,e("image widget"))}),n.for("downcast").add(te(o,"imageInline","src")).add(te(o,"imageInline","alt")).add(Wt(o,"imageInline")),n.for("upcast").elementToElement({view:Nt(t,"imageInline"),model:(s,{writer:l})=>l.createElement("imageInline",s.hasAttribute("src")?{src:s.getAttribute("src")}:void 0)})}_setupClipboardIntegration(){const t=this.editor,e=t.model,n=t.editing.view,o=t.plugins.get("ImageUtils"),s=t.plugins.get("ClipboardPipeline");this.listenTo(s,"inputTransformation",(l,r)=>{const a=Array.from(r.content.getChildren());let c;if(!a.every(o.isBlockImageView))return;r.targetRanges?c=t.editing.mapper.toModelRange(r.targetRanges[0]):c=e.document.selection.getFirstRange();const d=e.createSelection(c);if(Fe(e.schema,d)==="imageInline"){const m=new ft(n.document),u=a.map(h=>h.childCount===1?(Array.from(h.getAttributes()).forEach(f=>m.setAttribute(...f,o.findViewImgElement(h))),h.getChild(0)):h);r.content=m.createDocumentFragment(u)}}),this.listenTo(s,"contentInsertion",(l,r)=>{r.method==="paste"&&e.change(a=>{const c=a.createRangeIn(r.content);for(const d of c.getItems())d.is("element","imageInline")&&o.setImageNaturalSizeAttributes(d)})})}}class Ws extends C{static get requires(){return[zs,xe,zt,Jt]}static get pluginName(){return"ImageInline"}}class Ml extends C{static get requires(){return[Ds,Ws]}static get pluginName(){return"Image"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $s{constructor(){g(this,"_definitions",new Set)}get length(){return this._definitions.size}add(t){Array.isArray(t)?t.forEach(e=>this._definitions.add(e)):this._definitions.add(t)}getDispatcher(){return t=>{t.on("attribute:linkHref",(e,n,o)=>{if(!o.consumable.test(n.item,"attribute:linkHref")||!(n.item.is("selection")||o.schema.isInline(n.item)))return;const s=o.writer,l=s.document.selection;for(const r of this._definitions){const a=s.createAttributeElement("a",r.attributes,{priority:5});r.classes&&s.addClass(r.classes,a);for(const c in r.styles)s.setStyle(c,r.styles[c],a);s.setCustomProperty("link",!0,a),r.callback(n.attributeNewValue)?n.item.is("selection")?s.wrap(l.getFirstRange(),a):s.wrap(o.mapper.toViewRange(n.range),a):s.unwrap(o.mapper.toViewRange(n.range),a)}},{priority:"high"})}}getDispatcherForLinkedImage(){return t=>{t.on("attribute:linkHref:imageBlock",(e,n,{writer:o,mapper:s})=>{const l=s.toViewElement(n.item),r=Array.from(l.getChildren()).find(a=>a.is("element","a"));for(const a of this._definitions){const c=It(a.attributes);if(a.callback(n.attributeNewValue)){for(const[d,m]of c)d==="class"?o.addClass(m,r):o.setAttribute(d,m,r);a.classes&&o.addClass(a.classes,r);for(const d in a.styles)o.setStyle(d,a.styles[d],r)}else{for(const[d,m]of c)d==="class"?o.removeClass(m,r):o.removeAttribute(d,r);a.classes&&o.removeClass(a.classes,r);for(const d in a.styles)o.removeStyle(d,r)}}})}}}const Ks=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,qs="^(?:(?:<protocols>):|[^a-z]|[a-z+.-]+(?:[^a-z+.:-]|$))",js=/^[\S]+@((?![-_])(?:[-\w\u00a1-\uffff]{0,63}[^-_]\.))+(?:[a-z\u00a1-\uffff]{2,})$/i,Gs=/^((\w+:(\/{2,})?)|(\W))/i,Js=["https?","ftps?","mailto"],Z="Ctrl+K";function Ys(i){return i.is("attributeElement")&&!!i.getCustomProperty("link")}function Je(i,{writer:t}){const e=t.createAttributeElement("a",{href:i},{priority:5});return t.setCustomProperty("link",!0,e),e}function Yt(i,t=Js){const e=String(i),n=t.join("|"),o=new RegExp(`${qs.replace("<protocols>",n)}`,"i");return Zs(e,o)?e:"#"}function Zs(i,t){return!!i.replace(Ks,"").match(t)}function Xs(i,t){const e={"Open in a new tab":i("Open in a new tab"),Downloadable:i("Downloadable")};return t.forEach(n=>("label"in n&&e[n.label]&&(n.label=e[n.label]),n)),t}function Qs(i){const t=[];if(i)for(const[e,n]of Object.entries(i)){const o=Object.assign({},n,{id:`link${yo(e)}`});t.push(o)}return t}function Ie(i,t){return i?t.checkAttribute(i.name,"linkHref"):!1}function ei(i){return js.test(i)}function Pe(i,t){const e=ei(i)?"mailto:":t,n=!!e&&!Zt(i);return i&&n?e+i:i}function Zt(i){return Gs.test(i)}function Ye(i){window.open(i,"_blank","noopener")}class ti extends I{constructor(){super(...arguments);g(this,"manualDecorators",new q);g(this,"automaticDecorators",new $s)}restoreManualDecoratorStates(){for(const e of this.manualDecorators)e.value=this._getDecoratorStateFromModel(e.id)}refresh(){const e=this.editor.model,n=e.document.selection,o=n.getSelectedElement()||U(n.getSelectedBlocks());Ie(o,e.schema)?(this.value=o.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttribute(o,"linkHref")):(this.value=n.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttributeInSelection(n,"linkHref"));for(const s of this.manualDecorators)s.value=this._getDecoratorStateFromModel(s.id)}execute(e,n={}){const o=this.editor.model,s=o.document.selection,l=[],r=[];for(const a in n)n[a]?l.push(a):r.push(a);o.change(a=>{if(s.isCollapsed){const c=s.getFirstPosition();if(s.hasAttribute("linkHref")){const d=Ze(s);let m=Be(c,"linkHref",s.getAttribute("linkHref"),o);s.getAttribute("linkHref")===d&&(m=this._updateLinkContent(o,a,m,e)),a.setAttribute("linkHref",e,m),l.forEach(u=>{a.setAttribute(u,!0,m)}),r.forEach(u=>{a.removeAttribute(u,m)}),a.setSelection(a.createPositionAfter(m.end.nodeBefore))}else if(e!==""){const d=It(s.getAttributes());d.set("linkHref",e),l.forEach(u=>{d.set(u,!0)});const{end:m}=o.insertContent(a.createText(e,d),c);a.setSelection(m)}["linkHref",...l,...r].forEach(d=>{a.removeSelectionAttribute(d)})}else{const c=o.schema.getValidRanges(s.getRanges(),"linkHref"),d=[];for(const u of s.getSelectedBlocks())o.schema.checkAttribute(u,"linkHref")&&d.push(a.createRangeOn(u));const m=d.slice();for(const u of c)this._isRangeToUpdate(u,d)&&m.push(u);for(const u of m){let h=u;if(m.length===1){const f=Ze(s);s.getAttribute("linkHref")===f&&(h=this._updateLinkContent(o,a,u,e),a.setSelection(a.createSelection(h)))}a.setAttribute("linkHref",e,h),l.forEach(f=>{a.setAttribute(f,!0,h)}),r.forEach(f=>{a.removeAttribute(f,h)})}}})}_getDecoratorStateFromModel(e){const n=this.editor.model,o=n.document.selection,s=o.getSelectedElement();return Ie(s,n.schema)?s.getAttribute(e):o.getAttribute(e)}_isRangeToUpdate(e,n){for(const o of n)if(o.containsRange(e))return!1;return!0}_updateLinkContent(e,n,o,s){const l=n.createText(s,{linkHref:s});return e.insertContent(l,o)}}function Ze(i){if(i.isCollapsed){const t=i.getFirstPosition();return t.textNode&&t.textNode.data}else{const t=Array.from(i.getFirstRange().getItems());if(t.length>1)return null;const e=t[0];return e.is("$text")||e.is("$textProxy")?e.data:null}}class ni extends I{refresh(){const t=this.editor.model,e=t.document.selection,n=e.getSelectedElement();Ie(n,t.schema)?this.isEnabled=t.schema.checkAttribute(n,"linkHref"):this.isEnabled=t.schema.checkAttributeInSelection(e,"linkHref")}execute(){const t=this.editor,e=this.editor.model,n=e.document.selection,o=t.commands.get("link");e.change(s=>{const l=n.isCollapsed?[Be(n.getFirstPosition(),"linkHref",n.getAttribute("linkHref"),e)]:e.schema.getValidRanges(n.getRanges(),"linkHref");for(const r of l)if(s.removeAttribute("linkHref",r),o)for(const a of o.manualDecorators)s.removeAttribute(a.id,r)})}}class oi extends Gn(){constructor({id:e,label:n,attributes:o,classes:s,styles:l,defaultValue:r}){super();g(this,"id");g(this,"defaultValue");g(this,"label");g(this,"attributes");g(this,"classes");g(this,"styles");this.id=e,this.set("value",void 0),this.defaultValue=r,this.label=n,this.attributes=o,this.classes=s,this.styles=l}_createPattern(){return{attributes:this.attributes,classes:this.classes,styles:this.styles}}}const si="ck-link_selected",Xe="automatic",ii="manual",li=/^(https?:)?\/\//;class Xt extends C{static get pluginName(){return"LinkEditing"}static get requires(){return[Ue,Mn,re]}constructor(t){super(t),t.config.define("link",{allowCreatingEmptyLinks:!1,addTargetToExternalLinks:!1})}init(){const t=this.editor,e=this.editor.config.get("link.allowedProtocols");t.model.schema.extend("$text",{allowAttributes:"linkHref"}),t.conversion.for("dataDowncast").attributeToElement({model:"linkHref",view:Je}),t.conversion.for("editingDowncast").attributeToElement({model:"linkHref",view:(s,l)=>Je(Yt(s,e),l)}),t.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{href:!0}},model:{key:"linkHref",value:s=>s.getAttribute("href")}}),t.commands.add("link",new ti(t)),t.commands.add("unlink",new ni(t));const n=Xs(t.t,Qs(t.config.get("link.decorators")));this._enableAutomaticDecorators(n.filter(s=>s.mode===Xe)),this._enableManualDecorators(n.filter(s=>s.mode===ii)),t.plugins.get(Ue).registerAttribute("linkHref"),Dn(t,"linkHref","a",si),this._enableLinkOpen(),this._enableSelectionAttributesFixer(),this._enableClipboardIntegration()}_enableAutomaticDecorators(t){const e=this.editor,o=e.commands.get("link").automaticDecorators;e.config.get("link.addTargetToExternalLinks")&&o.add({id:"linkIsExternal",mode:Xe,callback:s=>!!s&&li.test(s),attributes:{target:"_blank",rel:"noopener noreferrer"}}),o.add(t),o.length&&e.conversion.for("downcast").add(o.getDispatcher())}_enableManualDecorators(t){if(!t.length)return;const e=this.editor,o=e.commands.get("link").manualDecorators;t.forEach(s=>{e.model.schema.extend("$text",{allowAttributes:s.id});const l=new oi(s);o.add(l),e.conversion.for("downcast").attributeToElement({model:l.id,view:(r,{writer:a,schema:c},{item:d})=>{if((d.is("selection")||c.isInline(d))&&r){const m=a.createAttributeElement("a",l.attributes,{priority:5});l.classes&&a.addClass(l.classes,m);for(const u in l.styles)a.setStyle(u,l.styles[u],m);return a.setCustomProperty("link",!0,m),m}}}),e.conversion.for("upcast").elementToAttribute({view:{name:"a",...l._createPattern()},model:{key:l.id}})})}_enableLinkOpen(){const t=this.editor,n=t.editing.view.document;this.listenTo(n,"click",(o,s)=>{if(!(zn.isMac?s.domEvent.metaKey:s.domEvent.ctrlKey))return;let r=s.domTarget;if(r.tagName.toLowerCase()!="a"&&(r=r.closest("a")),!r)return;const a=r.getAttribute("href");a&&(o.stop(),s.preventDefault(),Ye(a))},{context:"$capture"}),this.listenTo(n,"keydown",(o,s)=>{const r=t.commands.get("link").value;r&&s.keyCode===Wn.enter&&s.altKey&&(o.stop(),Ye(r))})}_enableSelectionAttributesFixer(){const e=this.editor.model,n=e.document.selection;this.listenTo(n,"change:attribute",(o,{attributeKeys:s})=>{!s.includes("linkHref")||n.hasAttribute("linkHref")||e.change(l=>{ri(l,ai(e.schema))})})}_enableClipboardIntegration(){const t=this.editor,e=t.model,n=this.editor.config.get("link.defaultProtocol");n&&this.listenTo(t.plugins.get("ClipboardPipeline"),"contentInsertion",(o,s)=>{e.change(l=>{const r=l.createRangeIn(s.content);for(const a of r.getItems())if(a.hasAttribute("linkHref")){const c=Pe(a.getAttribute("linkHref"),n);l.setAttribute("linkHref",c,a)}})})}}function ri(i,t){i.removeSelectionAttribute("linkHref");for(const e of t)i.removeSelectionAttribute(e)}function ai(i){return i.getDefinition("$text").allowAttributes.filter(e=>e.startsWith("link"))}class ci extends ${constructor(e,n,o){super(e);g(this,"focusTracker",new j);g(this,"keystrokes",new G);g(this,"urlInputView");g(this,"saveButtonView");g(this,"cancelButtonView");g(this,"_manualDecoratorSwitches");g(this,"children");g(this,"_validators");g(this,"_focusables",new ae);g(this,"_focusCycler");const s=e.t;this._validators=o,this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(s("Save"),S.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(s("Cancel"),S.cancel,"ck-button-cancel","cancel"),this._manualDecoratorSwitches=this._createManualDecoratorSwitches(n),this.children=this._createFormChildren(n.manualDecorators),this._focusCycler=new ce({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});const l=["ck","ck-link-form","ck-responsive-form"];n.manualDecorators.length&&l.push("ck-link-form_layout-vertical","ck-vertical-form"),this.setTemplate({tag:"form",attributes:{class:l,tabindex:"-1"},children:this.children})}getDecoratorSwitchesState(){return Array.from(this._manualDecoratorSwitches).reduce((e,n)=>(e[n.name]=n.isOn,e),{})}render(){super.render(),Ve({view:this}),[this.urlInputView,...this._manualDecoratorSwitches,this.saveButtonView,this.cancelButtonView].forEach(n=>{this._focusables.add(n),this.focusTracker.add(n.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}isValid(){this.resetFormStatus();for(const e of this._validators){const n=e(this);if(n)return this.urlInputView.errorText=n,!1}return!0}resetFormStatus(){this.urlInputView.errorText=null}_createUrlInput(){const e=this.locale.t,n=new vt(this.locale,kt);return n.fieldView.inputMode="url",n.label=e("Link URL"),n}_createButton(e,n,o,s){const l=new x(this.locale);return l.set({label:e,icon:n,tooltip:!0}),l.extendTemplate({attributes:{class:o}}),s&&l.delegate("execute").to(this,s),l}_createManualDecoratorSwitches(e){const n=this.createCollection();for(const o of e.manualDecorators){const s=new Tt(this.locale);s.set({name:o.id,label:o.label,withText:!0}),s.bind("isOn").toMany([o,e],"value",(l,r)=>r===void 0&&l===void 0?!!o.defaultValue:!!l),s.on("execute",()=>{o.set("value",!s.isOn)}),n.add(s)}return n}_createFormChildren(e){const n=this.createCollection();if(n.add(this.urlInputView),e.length){const o=new $;o.setTemplate({tag:"ul",children:this._manualDecoratorSwitches.map(s=>({tag:"li",children:[s],attributes:{class:["ck","ck-list__item"]}})),attributes:{class:["ck","ck-reset","ck-list"]}}),n.add(o)}return n.add(this.saveButtonView),n.add(this.cancelButtonView),n}get url(){const{element:e}=this.urlInputView.fieldView;return e?e.value.trim():null}}var di='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184zm4.919 10.562-1.414 1.414a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.061-1.06l1.414 1.414 1.414-1.415a.75.75 0 0 1 1.061 1.061l-1.414 1.414 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414z"/></svg>';class ui extends ${constructor(e,n={}){super(e);g(this,"focusTracker",new j);g(this,"keystrokes",new G);g(this,"previewButtonView");g(this,"unlinkButtonView");g(this,"editButtonView");g(this,"_focusables",new ae);g(this,"_focusCycler");g(this,"_linkConfig");const o=e.t;this.previewButtonView=this._createPreviewButton(),this.unlinkButtonView=this._createButton(o("Unlink"),di,"unlink"),this.editButtonView=this._createButton(o("Edit link"),S.pencil,"edit"),this.set("href",void 0),this._linkConfig=n,this._focusCycler=new ce({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-link-actions","ck-responsive-form"],tabindex:"-1"},children:[this.previewButtonView,this.editButtonView,this.unlinkButtonView]})}render(){super.render(),[this.previewButtonView,this.editButtonView,this.unlinkButtonView].forEach(n=>{this._focusables.add(n),this.focusTracker.add(n.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createButton(e,n,o){const s=new x(this.locale);return s.set({label:e,icon:n,tooltip:!0}),s.delegate("execute").to(this,o),s}_createPreviewButton(){const e=new x(this.locale),n=this.bindTemplate,o=this.t;return e.set({withText:!0,tooltip:o("Open link in new tab")}),e.extendTemplate({attributes:{class:["ck","ck-link-actions__preview"],href:n.to("href",s=>s&&Yt(s,this._linkConfig.allowedProtocols)),target:"_blank",rel:"noopener noreferrer"}}),e.bind("label").to(this,"href",s=>s||o("This link has no URL")),e.bind("isEnabled").to(this,"href",s=>!!s),e.template.tag="a",e.template.eventListeners={},e}}var mi='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184z"/></svg>';const E="link-ui";class hi extends C{constructor(){super(...arguments);g(this,"actionsView",null);g(this,"formView",null);g(this,"_balloon")}static get requires(){return[be]}static get pluginName(){return"LinkUI"}init(){const e=this.editor,n=this.editor.t;e.editing.view.addObserver($n),this._balloon=e.plugins.get(be),this._createToolbarLinkButton(),this._enableBalloonActivators(),e.conversion.for("editingDowncast").markerToHighlight({model:E,view:{classes:["ck-fake-link-selection"]}}),e.conversion.for("editingDowncast").markerToElement({model:E,view:(o,{writer:s})=>{if(!o.markerRange.isCollapsed)return null;const l=s.createUIElement("span");return s.addClass(["ck-fake-link-selection","ck-fake-link-selection_collapsed"],l),l}}),e.accessibility.addKeystrokeInfos({keystrokes:[{label:n("Create link"),keystroke:Z},{label:n("Move out of a link"),keystroke:[["arrowleft","arrowleft"],["arrowright","arrowright"]]}]})}destroy(){super.destroy(),this.formView&&this.formView.destroy(),this.actionsView&&this.actionsView.destroy()}_createViews(){this.actionsView=this._createActionsView(),this.formView=this._createFormView(),this._enableUserBalloonInteractions()}_createActionsView(){const e=this.editor,n=new ui(e.locale,e.config.get("link")),o=e.commands.get("link"),s=e.commands.get("unlink");return n.bind("href").to(o,"value"),n.editButtonView.bind("isEnabled").to(o),n.unlinkButtonView.bind("isEnabled").to(s),this.listenTo(n,"edit",()=>{this._addFormView()}),this.listenTo(n,"unlink",()=>{e.execute("unlink"),this._hideUI()}),n.keystrokes.set("Esc",(l,r)=>{this._hideUI(),r()}),n.keystrokes.set(Z,(l,r)=>{this._addFormView(),r()}),n}_createFormView(){const e=this.editor,n=e.commands.get("link"),o=e.config.get("link.defaultProtocol"),s=new(wt(ci))(e.locale,n,gi(e));return s.urlInputView.fieldView.bind("value").to(n,"value"),s.urlInputView.bind("isEnabled").to(n,"isEnabled"),s.saveButtonView.bind("isEnabled").to(n,"isEnabled"),this.listenTo(s,"submit",()=>{if(s.isValid()){const{value:l}=s.urlInputView.fieldView.element,r=Pe(l,o);e.execute("link",r,s.getDecoratorSwitchesState()),this._closeFormView()}}),this.listenTo(s.urlInputView,"change:errorText",()=>{e.ui.update()}),this.listenTo(s,"cancel",()=>{this._closeFormView()}),s.keystrokes.set("Esc",(l,r)=>{this._closeFormView(),r()}),s}_createToolbarLinkButton(){const e=this.editor;e.ui.componentFactory.add("link",()=>{const n=this._createButton(x);return n.set({tooltip:!0}),n}),e.ui.componentFactory.add("menuBar:link",()=>{const n=this._createButton(L);return n.set({role:"menuitemcheckbox"}),n})}_createButton(e){const n=this.editor,o=n.locale,s=n.commands.get("link"),l=new e(n.locale),r=o.t;return l.set({label:r("Link"),icon:mi,keystroke:Z,isToggleable:!0}),l.bind("isEnabled").to(s,"isEnabled"),l.bind("isOn").to(s,"value",a=>!!a),this.listenTo(l,"execute",()=>this._showUI(!0)),l}_enableBalloonActivators(){const e=this.editor,n=e.editing.view.document;this.listenTo(n,"click",()=>{this._getSelectedLinkElement()&&this._showUI()}),e.keystrokes.set(Z,(o,s)=>{s(),e.commands.get("link").isEnabled&&this._showUI(!0)})}_enableUserBalloonInteractions(){this.editor.keystrokes.set("Tab",(e,n)=>{this._areActionsVisible&&!this.actionsView.focusTracker.isFocused&&(this.actionsView.focus(),n())},{priority:"high"}),this.editor.keystrokes.set("Esc",(e,n)=>{this._isUIVisible&&(this._hideUI(),n())}),Ct({emitter:this.formView,activator:()=>this._isUIInPanel,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideUI()})}_addActionsView(){this.actionsView||this._createViews(),!this._areActionsInPanel&&this._balloon.add({view:this.actionsView,position:this._getBalloonPositionData()})}_addFormView(){if(this.formView||this._createViews(),this._isFormInPanel)return;const n=this.editor.commands.get("link");this.formView.disableCssTransitions(),this.formView.resetFormStatus(),this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this.formView.urlInputView.fieldView.value=n.value||"",this._balloon.visibleView===this.formView&&this.formView.urlInputView.fieldView.select(),this.formView.enableCssTransitions()}_closeFormView(){const e=this.editor.commands.get("link");e.restoreManualDecoratorStates(),e.value!==void 0?this._removeFormView():this._hideUI()}_removeFormView(){this._isFormInPanel&&(this.formView.saveButtonView.focus(),this.formView.urlInputView.fieldView.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus(),this._hideFakeVisualSelection())}_showUI(e=!1){this.formView||this._createViews(),this._getSelectedLinkElement()?(this._areActionsVisible?this._addFormView():this._addActionsView(),e&&this._balloon.showStack("main")):(this._showFakeVisualSelection(),this._addActionsView(),e&&this._balloon.showStack("main"),this._addFormView()),this._startUpdatingUI()}_hideUI(){if(!this._isUIInPanel)return;const e=this.editor;this.stopListening(e.ui,"update"),this.stopListening(this._balloon,"change:visibleView"),e.editing.view.focus(),this._removeFormView(),this._balloon.remove(this.actionsView),this._hideFakeVisualSelection()}_startUpdatingUI(){const e=this.editor,n=e.editing.view.document;let o=this._getSelectedLinkElement(),s=r();const l=()=>{const a=this._getSelectedLinkElement(),c=r();o&&!a||!o&&c!==s?this._hideUI():this._isUIVisible&&this._balloon.updatePosition(this._getBalloonPositionData()),o=a,s=c};function r(){return n.selection.focus.getAncestors().reverse().find(a=>a.is("element"))}this.listenTo(e.ui,"update",l),this.listenTo(this._balloon,"change:visibleView",l)}get _isFormInPanel(){return!!this.formView&&this._balloon.hasView(this.formView)}get _areActionsInPanel(){return!!this.actionsView&&this._balloon.hasView(this.actionsView)}get _areActionsVisible(){return!!this.actionsView&&this._balloon.visibleView===this.actionsView}get _isUIInPanel(){return this._isFormInPanel||this._areActionsInPanel}get _isUIVisible(){const e=this._balloon.visibleView;return!!this.formView&&e==this.formView||this._areActionsVisible}_getBalloonPositionData(){const e=this.editor.editing.view,n=this.editor.model,o=e.document;let s;if(n.markers.has(E)){const l=Array.from(this.editor.editing.mapper.markerNameToElements(E)),r=e.createRange(e.createPositionBefore(l[0]),e.createPositionAfter(l[l.length-1]));s=e.domConverter.viewRangeToDom(r)}else s=()=>{const l=this._getSelectedLinkElement();return l?e.domConverter.mapViewToDom(l):e.domConverter.viewRangeToDom(o.selection.getFirstRange())};return{target:s}}_getSelectedLinkElement(){const e=this.editor.editing.view,n=e.document.selection,o=n.getSelectedElement();if(n.isCollapsed||o&&Ee(o))return fe(n.getFirstPosition());{const s=n.getFirstRange().getTrimmed(),l=fe(s.start),r=fe(s.end);return!l||l!=r?null:e.createRangeIn(l).getTrimmed().isEqual(s)?l:null}}_showFakeVisualSelection(){const e=this.editor.model;e.change(n=>{const o=e.document.selection.getFirstRange();if(e.markers.has(E))n.updateMarker(E,{range:o});else if(o.start.isAtEnd){const s=o.start.getLastMatchingPosition(({item:l})=>!e.schema.isContent(l),{boundaries:o});n.addMarker(E,{usingOperation:!1,affectsData:!1,range:n.createRange(s,o.end)})}else n.addMarker(E,{usingOperation:!1,affectsData:!1,range:o})})}_hideFakeVisualSelection(){const e=this.editor.model;e.markers.has(E)&&e.change(n=>{n.removeMarker(E)})}}function fe(i){return i.getAncestors().find(t=>Ys(t))||null}function gi(i){const t=i.t,e=i.config.get("link.allowCreatingEmptyLinks");return[n=>{if(!e&&!n.url.length)return t("Link URL must not be empty.")}]}const fi=4,Qt=new RegExp("(^|\\s)(((?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(((?!www\\.)|(www\\.))(?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.)+(?:[a-z\\u00a1-\\uffff]{2,63})))(?::\\d{2,5})?(?:[/?#]\\S*)?)|((www.|(\\S+@))((?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.))+(?:[a-z\\u00a1-\\uffff]{2,63})))$","i"),pi=2;class bi extends C{static get requires(){return[Kn,Xt]}static get pluginName(){return"AutoLink"}init(){const e=this.editor.model.document.selection;e.on("change:range",()=>{this.isEnabled=!e.anchor.parent.is("element","codeBlock")}),this._enableTypingHandling()}afterInit(){this._enableEnterHandling(),this._enableShiftEnterHandling(),this._enablePasteLinking()}_expandLinkRange(t,e){return e.textNode&&e.textNode.hasAttribute("linkHref")?Be(e,"linkHref",e.textNode.getAttribute("linkHref"),t):null}_selectEntireLinks(t,e){const o=this.editor.model,s=o.document.selection,l=s.getFirstPosition(),r=s.getLastPosition();let a=e.getJoined(this._expandLinkRange(o,l)||e);a&&(a=a.getJoined(this._expandLinkRange(o,r)||e)),a&&(a.start.isBefore(l)||a.end.isAfter(r))&&t.setSelection(a)}_enablePasteLinking(){const t=this.editor,e=t.model,n=e.document.selection,o=t.plugins.get("ClipboardPipeline"),s=t.commands.get("link");o.on("inputTransformation",(l,r)=>{if(!this.isEnabled||!s.isEnabled||n.isCollapsed||r.method!=="paste"||n.rangeCount>1)return;const a=n.getFirstRange(),c=r.dataTransfer.getData("text/plain");if(!c)return;const d=c.match(Qt);d&&d[2]===c&&(e.change(m=>{this._selectEntireLinks(m,a),s.execute(c)}),l.stop())},{priority:"high"})}_enableTypingHandling(){const t=this.editor,e=new qn(t.model,n=>{if(!wi(n))return;const o=Qe(n.substr(0,n.length-1));if(o)return{url:o}});e.on("matched:data",(n,o)=>{const{batch:s,range:l,url:r}=o;if(!s.isTyping)return;const a=l.end.getShiftedBy(-1),c=a.getShiftedBy(-r.length),d=t.model.createRange(c,a);this._applyAutoLink(r,d)}),e.bind("isEnabled").to(this)}_enableEnterHandling(){const t=this.editor,e=t.model,n=t.commands.get("enter");n&&n.on("execute",()=>{const o=e.document.selection.getFirstPosition();if(!o.parent.previousSibling)return;const s=e.createRangeIn(o.parent.previousSibling);this._checkAndApplyAutoLinkOnRange(s)})}_enableShiftEnterHandling(){const t=this.editor,e=t.model,n=t.commands.get("shiftEnter");n&&n.on("execute",()=>{const o=e.document.selection.getFirstPosition(),s=e.createRange(e.createPositionAt(o.parent,0),o.getShiftedBy(-1));this._checkAndApplyAutoLinkOnRange(s)})}_checkAndApplyAutoLinkOnRange(t){const e=this.editor.model,{text:n,range:o}=jn(t,e),s=Qe(n);if(s){const l=e.createRange(o.end.getShiftedBy(-s.length),o.end);this._applyAutoLink(s,l)}}_applyAutoLink(t,e){const n=this.editor.model,o=this.editor.config.get("link.defaultProtocol"),s=Pe(t,o);!this.isEnabled||!Ci(e,n)||!Zt(s)||vi(e)||this._persistAutoLink(s,e)}_persistAutoLink(t,e){const n=this.editor.model,o=this.editor.plugins.get("Delete");n.enqueueChange(s=>{s.setAttribute("linkHref",t,e),n.enqueueChange(()=>{o.requestUndoOnBackspace()})})}}function wi(i){return i.length>fi&&i[i.length-1]===" "&&i[i.length-2]!==" "}function Qe(i){const t=Qt.exec(i);return t?t[pi]:null}function Ci(i,t){return t.schema.checkAttributeInSelection(t.createSelection(i),"linkHref")}function vi(i){const t=i.start.nodeAfter;return!!t&&t.hasAttribute("linkHref")}class Dl extends C{static get requires(){return[Xt,hi,bi]}static get pluginName(){return"Link"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function T(i,t,e,n,o=1){t!=null&&o!==void 0&&o!==null&&t>o?n.setAttribute(i,t,e):n.removeAttribute(i,e)}function N(i,t,e={}){const n=i.createElement("tableCell",e);return i.insertElement("paragraph",n),i.insert(n,t),n}function Te(i,t){const e=t.parent.parent,n=parseInt(e.getAttribute("headingColumns")||"0"),{column:o}=i.getCellLocation(t);return!!n&&o<n}function ki(){return i=>{i.on("element:figure",(t,e,n)=>{if(!n.consumable.test(e.viewItem,{name:!0,classes:"table"}))return;const o=_i(e.viewItem);if(!o||!n.consumable.test(o,{name:!0}))return;n.consumable.consume(e.viewItem,{name:!0,classes:"table"});const s=n.convertItem(o,e.modelCursor),l=U(s.modelRange.getItems());if(!l){n.consumable.revert(e.viewItem,{name:!0,classes:"table"});return}n.convertChildren(e.viewItem,n.writer.createPositionAt(l,"end")),n.updateConversionResult(l,e)})}}function Ii(){return i=>{i.on("element:table",(t,e,n)=>{const o=e.viewItem;if(!n.consumable.test(o,{name:!0}))return;const{rows:s,headingRows:l,headingColumns:r}=yi(o),a={};r&&(a.headingColumns=r),l&&(a.headingRows=l);const c=n.writer.createElement("table",a);if(n.safeInsert(c,e.modelCursor)){if(n.consumable.consume(o,{name:!0}),s.forEach(d=>n.convertItem(d,n.writer.createPositionAt(c,"end"))),n.convertChildren(o,n.writer.createPositionAt(c,"end")),c.isEmpty){const d=n.writer.createElement("tableRow");n.writer.insert(d,n.writer.createPositionAt(c,"end")),N(n.writer,n.writer.createPositionAt(d,"end"))}n.updateConversionResult(c,e)}})}}function Ti(){return i=>{i.on("element:tr",(t,e)=>{e.viewItem.isEmpty&&e.modelCursor.index==0&&t.stop()},{priority:"high"})}}function et(i){return t=>{t.on(`element:${i}`,(e,n,{writer:o})=>{if(!n.modelRange)return;const s=n.modelRange.start.nodeAfter,l=o.createPositionAt(s,0);if(n.viewItem.isEmpty){o.insertElement("paragraph",l);return}const r=Array.from(s.getChildren());if(r.every(a=>a.is("element","$marker"))){const a=o.createElement("paragraph");o.insert(a,o.createPositionAt(s,0));for(const c of r)o.move(o.createRangeOn(c),o.createPositionAt(a,"end"))}},{priority:"low"})}}function _i(i){for(const t of i.getChildren())if(t.is("element","table"))return t}function yi(i){let t=0,e;const n=[],o=[];let s;for(const l of Array.from(i.getChildren())){if(l.name!=="tbody"&&l.name!=="thead"&&l.name!=="tfoot")continue;l.name==="thead"&&!s&&(s=l);const r=Array.from(l.getChildren()).filter(a=>a.is("element","tr"));for(const a of r)if(s&&l===s||l.name==="tbody"&&Array.from(a.getChildren()).length&&Array.from(a.getChildren()).every(c=>c.is("element","th")))t++,n.push(a);else{o.push(a);const c=Ai(a);(!e||c<e)&&(e=c)}}return{headingRows:t,headingColumns:e||0,rows:[...n,...o]}}function Ai(i){let t=0,e=0;const n=Array.from(i.getChildren()).filter(o=>o.name==="th"||o.name==="td");for(;e<n.length&&n[e].name==="th";){const o=n[e],s=parseInt(o.getAttribute("colspan")||"1");t=t+s,e++}return t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class k{constructor(t,e={}){g(this,"_table");g(this,"_startRow");g(this,"_endRow");g(this,"_startColumn");g(this,"_endColumn");g(this,"_includeAllSlots");g(this,"_skipRows");g(this,"_row");g(this,"_rowIndex");g(this,"_column");g(this,"_cellIndex");g(this,"_spannedCells");g(this,"_nextCellAtColumn");g(this,"_jumpedToStartRow",!1);this._table=t,this._startRow=e.row!==void 0?e.row:e.startRow||0,this._endRow=e.row!==void 0?e.row:e.endRow,this._startColumn=e.column!==void 0?e.column:e.startColumn||0,this._endColumn=e.column!==void 0?e.column:e.endColumn,this._includeAllSlots=!!e.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){this._canJumpToStartRow()&&this._jumpToNonSpannedRowClosestToStartRow();const t=this._table.getChild(this._rowIndex);if(!t||this._isOverEndRow())return{done:!0,value:void 0};if(!t.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let e=null;const n=this._getSpanned();if(n)this._includeAllSlots&&!this._shouldSkipSlot()&&(e=this._formatOutValue(n.cell,n.row,n.column));else{const o=t.getChild(this._cellIndex);if(!o)return this._advanceToNextRow();const s=parseInt(o.getAttribute("colspan")||"1"),l=parseInt(o.getAttribute("rowspan")||"1");(s>1||l>1)&&this._recordSpans(o,l,s),this._shouldSkipSlot()||(e=this._formatOutValue(o)),this._nextCellAtColumn=this._column+s}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,e||this.next()}skipRow(t){this._skipRows.add(t)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return this._endRow!==void 0&&this._row>this._endRow}_isOverEndColumn(){return this._endColumn!==void 0&&this._column>this._endColumn}_formatOutValue(t,e=this._row,n=this._column){return{done:!1,value:new Si(this,t,e,n)}}_shouldSkipSlot(){const t=this._skipRows.has(this._row),e=this._row<this._startRow,n=this._column<this._startColumn,o=this._endColumn!==void 0&&this._column>this._endColumn;return t||e||n||o}_getSpanned(){const t=this._spannedCells.get(this._row);return t&&t.get(this._column)||null}_recordSpans(t,e,n){const o={cell:t,row:this._row,column:this._column};for(let s=this._row;s<this._row+e;s++)for(let l=this._column;l<this._column+n;l++)(s!=this._row||l!=this._column)&&this._markSpannedCell(s,l,o)}_markSpannedCell(t,e,n){this._spannedCells.has(t)||this._spannedCells.set(t,new Map),this._spannedCells.get(t).set(e,n)}_canJumpToStartRow(){return!!this._startRow&&this._startRow>0&&!this._jumpedToStartRow}_jumpToNonSpannedRowClosestToStartRow(){const t=this._getRowLength(0);for(let e=this._startRow;!this._jumpedToStartRow;e--)t===this._getRowLength(e)&&(this._row=e,this._rowIndex=e,this._jumpedToStartRow=!0)}_getRowLength(t){return[...this._table.getChild(t).getChildren()].reduce((n,o)=>n+parseInt(o.getAttribute("colspan")||"1"),0)}}class Si{constructor(t,e,n,o){g(this,"cell");g(this,"row");g(this,"column");g(this,"cellAnchorRow");g(this,"cellAnchorColumn");g(this,"_cellIndex");g(this,"_rowIndex");g(this,"_table");this.cell=e,this.row=t._row,this.column=t._column,this.cellAnchorRow=n,this.cellAnchorColumn=o,this._cellIndex=t._cellIndex,this._rowIndex=t._rowIndex,this._table=t._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||"1")}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||"1")}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}function tt(i,t){return(e,{writer:n})=>{const o=e.getAttribute("headingRows")||0,s=n.createContainerElement("table",null,[]),l=n.createContainerElement("figure",{class:"table"},s);o>0&&n.insert(n.createPositionAt(s,"end"),n.createContainerElement("thead",null,n.createSlot(r=>r.is("element","tableRow")&&r.index<o))),o<i.getRows(e)&&n.insert(n.createPositionAt(s,"end"),n.createContainerElement("tbody",null,n.createSlot(r=>r.is("element","tableRow")&&r.index>=o)));for(const{positionOffset:r,filter:a}of t.additionalSlots)n.insert(n.createPositionAt(s,r),n.createSlot(a));return n.insert(n.createPositionAt(s,"after"),n.createSlot(r=>r.is("element","tableRow")?!1:!t.additionalSlots.some(({filter:a})=>a(r)))),t.asWidget?xi(l,n):l}}function Ri(){return(i,{writer:t})=>i.isEmpty?t.createEmptyElement("tr"):t.createContainerElement("tr")}function nt(i={}){return(t,{writer:e})=>{const n=t.parent,o=n.parent,s=o.getChildIndex(n),l=new k(o,{row:s}),r=o.getAttribute("headingRows")||0,a=o.getAttribute("headingColumns")||0;let c=null;for(const d of l)if(d.cell==t){const u=d.row<r||d.column<a?"th":"td";c=i.asWidget?Yn(e.createEditableElement(u),e):e.createContainerElement(u);break}return c}}function ot(i={}){return(t,{writer:e})=>{if(!t.parent.is("element","tableCell")||!en(t))return null;if(i.asWidget)return e.createContainerElement("span",{class:"ck-table-bogus-paragraph"});{const n=e.createContainerElement("p");return e.setCustomProperty("dataPipeline:transparentRendering",!0,n),n}}}function en(i){return i.parent.childCount==1&&!Ei(i)}function xi(i,t){return t.setCustomProperty("table",!0,i),bt(i,t,{hasSelectionHandle:!0})}function Ei(i){return!i.getAttributeKeys().next().done}class Vi extends I{refresh(){const t=this.editor.model,e=t.document.selection,n=t.schema;this.isEnabled=Bi(e,n)}execute(t={}){const e=this.editor,n=e.model,o=e.plugins.get("TableUtils"),s=e.config.get("table.defaultHeadings.rows"),l=e.config.get("table.defaultHeadings.columns");t.headingRows===void 0&&s&&(t.headingRows=s),t.headingColumns===void 0&&l&&(t.headingColumns=l),n.change(r=>{const a=o.createTable(r,t);n.insertObject(a,null,null,{findOptimalPosition:"auto"}),r.setSelection(r.createPositionAt(a.getNodeByPath([0,0,0]),0))})}}function Bi(i,t){const e=i.getFirstPosition().parent,n=e===e.root?e:e.parent;return t.checkChild(n,"table")}class st extends I{constructor(e,n={}){super(e);g(this,"order");this.order=n.order||"below"}refresh(){const e=this.editor.model.document.selection,o=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=o}execute(){const e=this.editor,n=e.model.document.selection,o=e.plugins.get("TableUtils"),s=this.order==="above",l=o.getSelectionAffectedTableCells(n),r=o.getRowIndexes(l),a=s?r.first:r.last,c=l[0].findAncestor("table");o.insertRows(c,{at:s?a:a+1,copyStructureFromAbove:!s})}}class it extends I{constructor(e,n={}){super(e);g(this,"order");this.order=n.order||"right"}refresh(){const e=this.editor.model.document.selection,o=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=o}execute(){const e=this.editor,n=e.model.document.selection,o=e.plugins.get("TableUtils"),s=this.order==="left",l=o.getSelectionAffectedTableCells(n),r=o.getColumnIndexes(l),a=s?r.first:r.last,c=l[0].findAncestor("table");o.insertColumns(c,{columns:1,at:s?a:a+1})}}class lt extends I{constructor(e,n={}){super(e);g(this,"direction");this.direction=n.direction||"horizontally"}refresh(){const n=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=n.length===1}execute(){const e=this.editor.plugins.get("TableUtils"),n=e.getSelectionAffectedTableCells(this.editor.model.document.selection)[0];this.direction==="horizontally"?e.splitCellHorizontally(n,2):e.splitCellVertically(n,2)}}function tn(i,t,e){const{startRow:n,startColumn:o,endRow:s,endColumn:l}=t,r=e.createElement("table"),a=s-n+1;for(let d=0;d<a;d++)e.insertElement("tableRow",r,"end");const c=[...new k(i,{startRow:n,endRow:s,startColumn:o,endColumn:l,includeAllSlots:!0})];for(const{row:d,column:m,cell:u,isAnchor:h,cellAnchorRow:f,cellAnchorColumn:p}of c){const w=d-n,b=r.getChild(w);if(!h)(f<n||p<o)&&N(e,e.createPositionAt(b,"end"));else{const v=e.cloneElement(u);e.append(v,b),rn(v,d,m,s,l,e)}}return Li(r,i,n,o,e),r}function nn(i,t,e=0){const n=[],o=new k(i,{startRow:e,endRow:t-1});for(const s of o){const{row:l,cellHeight:r}=s,a=l+r-1;l<t&&t<=a&&n.push(s)}return n}function on(i,t,e){const n=i.parent,o=n.parent,s=n.index,l=parseInt(i.getAttribute("rowspan")),r=t-s,a={},c=l-r;c>1&&(a.rowspan=c);const d=parseInt(i.getAttribute("colspan")||"1");d>1&&(a.colspan=d);const m=s,u=m+r,h=[...new k(o,{startRow:m,endRow:u,includeAllSlots:!0})];let f=null,p;for(const w of h){const{row:b,column:v,cell:R}=w;R===i&&p===void 0&&(p=v),p!==void 0&&p===v&&b===u&&(f=N(e,w.getPositionBefore(),a))}return T("rowspan",r,i,e),f}function sn(i,t){const e=[],n=new k(i);for(const o of n){const{column:s,cellWidth:l}=o,r=s+l-1;s<t&&t<=r&&e.push(o)}return e}function ln(i,t,e,n){const o=parseInt(i.getAttribute("colspan")),s=e-t,l={},r=o-s;r>1&&(l.colspan=r);const a=parseInt(i.getAttribute("rowspan")||"1");a>1&&(l.rowspan=a);const c=N(n,n.createPositionAfter(i),l);return T("colspan",s,i,n),c}function rn(i,t,e,n,o,s){const l=parseInt(i.getAttribute("colspan")||"1"),r=parseInt(i.getAttribute("rowspan")||"1");if(e+l-1>o){const d=o-e+1;T("colspan",d,i,s,1)}if(t+r-1>n){const d=n-t+1;T("rowspan",d,i,s,1)}}function Li(i,t,e,n,o){const s=parseInt(t.getAttribute("headingRows")||"0");if(s>0){const r=s-e;T("headingRows",r,i,o,0)}const l=parseInt(t.getAttribute("headingColumns")||"0");if(l>0){const r=l-n;T("headingColumns",r,i,o,0)}}function _e(i,t){const e=t.getColumns(i),n=new Array(e).fill(0);for(const{column:s}of new k(i))n[s]++;const o=n.reduce((s,l,r)=>l?s:[...s,r],[]);if(o.length>0){const s=o[o.length-1];return t.removeColumns(i,{at:s}),!0}return!1}function ye(i,t){const e=[],n=t.getRows(i);for(let o=0;o<n;o++)i.getChild(o).isEmpty&&e.push(o);if(e.length>0){const o=e[e.length-1];return t.removeRows(i,{at:o}),!0}return!1}function He(i,t){_e(i,t)||ye(i,t)}function an(i,t){const e=Array.from(new k(i,{startColumn:t.firstColumn,endColumn:t.lastColumn,row:t.lastRow}));if(e.every(({cellHeight:s})=>s===1))return t.lastRow;const o=e[0].cellHeight-1;return t.lastRow+o}function cn(i,t){const e=Array.from(new k(i,{startRow:t.firstRow,endRow:t.lastRow,column:t.lastColumn}));if(e.every(({cellWidth:s})=>s===1))return t.lastColumn;const o=e[0].cellWidth-1;return t.lastColumn+o}class X extends I{constructor(e,n){super(e);g(this,"direction");g(this,"isHorizontal");this.direction=n.direction,this.isHorizontal=this.direction=="right"||this.direction=="left"}refresh(){const e=this._getMergeableCell();this.value=e,this.isEnabled=!!e}execute(){const e=this.editor.model,n=e.document,s=this.editor.plugins.get("TableUtils").getTableCellsContainingSelection(n.selection)[0],l=this.value,r=this.direction;e.change(a=>{const c=r=="right"||r=="down",d=c?s:l,m=c?l:s,u=m.parent;Hi(m,d,a);const h=this.isHorizontal?"colspan":"rowspan",f=parseInt(s.getAttribute(h)||"1"),p=parseInt(l.getAttribute(h)||"1");a.setAttribute(h,f+p,d),a.setSelection(a.createRangeIn(d));const w=this.editor.plugins.get("TableUtils"),b=u.findAncestor("table");He(b,w)})}_getMergeableCell(){const n=this.editor.model.document,o=this.editor.plugins.get("TableUtils"),s=o.getTableCellsContainingSelection(n.selection)[0];if(!s)return;const l=this.isHorizontal?Fi(s,this.direction,o):Pi(s,this.direction,o);if(!l)return;const r=this.isHorizontal?"rowspan":"colspan",a=parseInt(s.getAttribute(r)||"1");if(parseInt(l.getAttribute(r)||"1")===a)return l}}function Fi(i,t,e){const o=i.parent.parent,s=t=="right"?i.nextSibling:i.previousSibling,l=(o.getAttribute("headingColumns")||0)>0;if(!s)return;const r=t=="right"?i:s,a=t=="right"?s:i,{column:c}=e.getCellLocation(r),{column:d}=e.getCellLocation(a),m=parseInt(r.getAttribute("colspan")||"1"),u=Te(e,r),h=Te(e,a);return l&&u!=h?void 0:c+m===d?s:void 0}function Pi(i,t,e){const n=i.parent,o=n.parent,s=o.getChildIndex(n);if(t=="down"&&s===e.getRows(o)-1||t=="up"&&s===0)return null;const l=parseInt(i.getAttribute("rowspan")||"1"),r=o.getAttribute("headingRows")||0,a=t=="down"&&s+l===r,c=t=="up"&&s===r;if(r&&(a||c))return null;const d=parseInt(i.getAttribute("rowspan")||"1"),m=t=="down"?s+d:s,u=[...new k(o,{endRow:m})],f=u.find(w=>w.cell===i).column,p=u.find(({row:w,cellHeight:b,column:v})=>v!==f?!1:t=="down"?w===m:m===w+b);return p&&p.cell?p.cell:null}function Hi(i,t,e){rt(i)||(rt(t)&&e.remove(e.createRangeIn(t)),e.move(e.createRangeIn(i),e.createPositionAt(t,"end"))),e.remove(i)}function rt(i){const t=i.getChild(0);return i.childCount==1&&t.is("element","paragraph")&&t.isEmpty}class Ui extends I{refresh(){const t=this.editor.plugins.get("TableUtils"),e=t.getSelectionAffectedTableCells(this.editor.model.document.selection),n=e[0];if(n){const o=n.findAncestor("table"),l=t.getRows(o)-1,r=t.getRowIndexes(e),a=r.first===0&&r.last===l;this.isEnabled=!a}else this.isEnabled=!1}execute(){const t=this.editor.model,e=this.editor.plugins.get("TableUtils"),n=e.getSelectionAffectedTableCells(t.document.selection),o=e.getRowIndexes(n),s=n[0],l=s.findAncestor("table"),r=e.getCellLocation(s).column;t.change(a=>{const c=o.last-o.first+1;e.removeRows(l,{at:o.first,rows:c});const d=Oi(l,o.first,r,e.getRows(l));a.setSelection(a.createPositionAt(d,0))})}}function Oi(i,t,e,n){const o=i.getChild(Math.min(t,n-1));let s=o.getChild(0),l=0;for(const r of o.getChildren()){if(l>e)return s;s=r,l+=parseInt(r.getAttribute("colspan")||"1")}return s}class Ni extends I{refresh(){const t=this.editor.plugins.get("TableUtils"),e=t.getSelectionAffectedTableCells(this.editor.model.document.selection),n=e[0];if(n){const o=n.findAncestor("table"),s=t.getColumns(o),{first:l,last:r}=t.getColumnIndexes(e);this.isEnabled=r-l<s-1}else this.isEnabled=!1}execute(){const t=this.editor.plugins.get("TableUtils"),[e,n]=Di(this.editor.model.document.selection,t),o=e.parent.parent,s=[...new k(o)],l={first:s.find(a=>a.cell===e).column,last:s.find(a=>a.cell===n).column},r=Mi(s,e,n,l);this.editor.model.change(a=>{const c=l.last-l.first+1;t.removeColumns(o,{at:l.first,columns:c}),a.setSelection(a.createPositionAt(r,0))})}}function Mi(i,t,e,n){return parseInt(e.getAttribute("colspan")||"1")>1?e:t.previousSibling||e.nextSibling?e.nextSibling||t.previousSibling:n.first?i.reverse().find(({column:s})=>s<n.first).cell:i.reverse().find(({column:s})=>s>n.last).cell}function Di(i,t){const e=t.getSelectionAffectedTableCells(i),n=e[0],o=e.pop(),s=[n,o];return n.isBefore(o)?s:s.reverse()}class zi extends I{refresh(){const t=this.editor.plugins.get("TableUtils"),e=this.editor.model,n=t.getSelectionAffectedTableCells(e.document.selection),o=n.length>0;this.isEnabled=o,this.value=o&&n.every(s=>this._isInHeading(s,s.parent.parent))}execute(t={}){if(t.forceValue===this.value)return;const e=this.editor.plugins.get("TableUtils"),n=this.editor.model,o=e.getSelectionAffectedTableCells(n.document.selection),s=o[0].findAncestor("table"),{first:l,last:r}=e.getRowIndexes(o),a=this.value?l:r+1,c=s.getAttribute("headingRows")||0;n.change(d=>{if(a){const m=a>c?c:0,u=nn(s,a,m);for(const{cell:h}of u)on(h,a,d)}T("headingRows",a,s,d,0)})}_isInHeading(t,e){const n=parseInt(e.getAttribute("headingRows")||"0");return!!n&&t.parent.index<n}}class Wi extends I{refresh(){const t=this.editor.model,e=this.editor.plugins.get("TableUtils"),n=e.getSelectionAffectedTableCells(t.document.selection),o=n.length>0;this.isEnabled=o,this.value=o&&n.every(s=>Te(e,s))}execute(t={}){if(t.forceValue===this.value)return;const e=this.editor.plugins.get("TableUtils"),n=this.editor.model,o=e.getSelectionAffectedTableCells(n.document.selection),s=o[0].findAncestor("table"),{first:l,last:r}=e.getColumnIndexes(o),a=this.value?l:r+1;n.change(c=>{if(a){const d=sn(s,a);for(const{cell:m,column:u}of d)ln(m,u,a,c)}T("headingColumns",a,s,c,0)})}}function $i(i){if(i.is("element","tableColumnGroup"))return i;const t=i.getChildren();return Array.from(t).find(e=>e.is("element","tableColumnGroup"))}function Ki(i){const t=$i(i);return t?Array.from(t.getChildren()):[]}class _ extends C{static get pluginName(){return"TableUtils"}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(t){const e=t.parent,n=e.parent,o=n.getChildIndex(e),s=new k(n,{row:o});for(const{cell:l,row:r,column:a}of s)if(l===t)return{row:r,column:a};/* istanbul ignore next -- @preserve */}createTable(t,e){const n=t.createElement("table"),o=e.rows||2,s=e.columns||2;return pe(t,n,0,o,s),e.headingRows&&T("headingRows",Math.min(e.headingRows,o),n,t,0),e.headingColumns&&T("headingColumns",Math.min(e.headingColumns,s),n,t,0),n}insertRows(t,e={}){const n=this.editor.model,o=e.at||0,s=e.rows||1,l=e.copyStructureFromAbove!==void 0,r=e.copyStructureFromAbove?o-1:o,a=this.getRows(t),c=this.getColumns(t);if(o>a)throw new Q("tableutils-insertrows-insert-out-of-range",this,{options:e});n.change(d=>{const m=t.getAttribute("headingRows")||0;if(m>o&&T("headingRows",m+s,t,d,0),!l&&(o===0||o===a)){pe(d,t,o,s,c);return}const u=l?Math.max(o,r):o,h=new k(t,{endRow:u}),f=new Array(c).fill(1);for(const{row:p,column:w,cellHeight:b,cellWidth:v,cell:R}of h){const P=p+b-1,J=p<o&&o<=P,ue=p<=r&&r<=P;J?(d.setAttribute("rowspan",b+s,R),f[w]=-v):l&&ue&&(f[w]=v)}for(let p=0;p<s;p++){const w=d.createElement("tableRow");d.insert(w,t,o);for(let b=0;b<f.length;b++){const v=f[b],R=d.createPositionAt(w,"end");v>0&&N(d,R,v>1?{colspan:v}:void 0),b+=Math.abs(v)-1}}})}insertColumns(t,e={}){const n=this.editor.model,o=e.at||0,s=e.columns||1;n.change(l=>{const r=t.getAttribute("headingColumns");o<r&&l.setAttribute("headingColumns",r+s,t);const a=this.getColumns(t);if(o===0||a===o){for(const d of t.getChildren())d.is("element","tableRow")&&z(s,l,l.createPositionAt(d,o?"end":0));return}const c=new k(t,{column:o,includeAllSlots:!0});for(const d of c){const{row:m,cell:u,cellAnchorColumn:h,cellAnchorRow:f,cellWidth:p,cellHeight:w}=d;if(h<o){l.setAttribute("colspan",p+s,u);const b=f+w-1;for(let v=m;v<=b;v++)c.skipRow(v)}else z(s,l,d.getPositionBefore())}})}removeRows(t,e){const n=this.editor.model,o=e.rows||1,s=this.getRows(t),l=e.at,r=l+o-1;if(r>s-1)throw new Q("tableutils-removerows-row-index-out-of-range",this,{table:t,options:e});n.change(a=>{const c={first:l,last:r},{cellsToMove:d,cellsToTrim:m}=Gi(t,c);if(d.size){const u=r+1;Ji(t,u,d,a)}for(let u=r;u>=l;u--)a.remove(t.getChild(u));for(const{rowspan:u,cell:h}of m)T("rowspan",u,h,a);ji(t,c,a),_e(t,this)||ye(t,this)})}removeColumns(t,e){const n=this.editor.model,o=e.at,s=e.columns||1,l=e.at+s-1;n.change(r=>{qi(t,{first:o,last:l},r);const a=Ki(t);for(let c=l;c>=o;c--){for(const{cell:d,column:m,cellWidth:u}of[...new k(t)])m<=c&&u>1&&m+u>c?T("colspan",u-1,d,r):m===c&&r.remove(d);if(a[c]){const d=c===0?a[1]:a[c-1],m=parseFloat(a[c].getAttribute("columnWidth")),u=parseFloat(d.getAttribute("columnWidth"));r.remove(a[c]),r.setAttribute("columnWidth",m+u+"%",d)}}ye(t,this)||_e(t,this)})}splitCellVertically(t,e=2){const n=this.editor.model,s=t.parent.parent,l=parseInt(t.getAttribute("rowspan")||"1"),r=parseInt(t.getAttribute("colspan")||"1");n.change(a=>{if(r>1){const{newCellsSpan:c,updatedSpan:d}=at(r,e);T("colspan",d,t,a);const m={};c>1&&(m.colspan=c),l>1&&(m.rowspan=l);const u=r>e?e-1:r-1;z(u,a,a.createPositionAfter(t),m)}if(r<e){const c=e-r,d=[...new k(s)],{column:m}=d.find(({cell:p})=>p===t),u=d.filter(({cell:p,cellWidth:w,column:b})=>{const v=p!==t&&b===m,R=b<m&&b+w>m;return v||R});for(const{cell:p,cellWidth:w}of u)a.setAttribute("colspan",w+c,p);const h={};l>1&&(h.rowspan=l),z(c,a,a.createPositionAfter(t),h);const f=s.getAttribute("headingColumns")||0;f>m&&T("headingColumns",f+c,s,a)}})}splitCellHorizontally(t,e=2){const n=this.editor.model,o=t.parent,s=o.parent,l=s.getChildIndex(o),r=parseInt(t.getAttribute("rowspan")||"1"),a=parseInt(t.getAttribute("colspan")||"1");n.change(c=>{if(r>1){const d=[...new k(s,{startRow:l,endRow:l+r-1,includeAllSlots:!0})],{newCellsSpan:m,updatedSpan:u}=at(r,e);T("rowspan",u,t,c);const{column:h}=d.find(({cell:w})=>w===t),f={};m>1&&(f.rowspan=m),a>1&&(f.colspan=a);let p=0;for(const w of d){const{column:b,row:v}=w,R=v>=l+u,P=b===h;p>=m&&P&&(p=0),R&&P&&(p||z(1,c,w.getPositionBefore(),f),p++)}}if(r<e){const d=e-r,m=[...new k(s,{startRow:0,endRow:l})];for(const{cell:f,cellHeight:p,row:w}of m)if(f!==t&&w+p>l){const b=p+d;c.setAttribute("rowspan",b,f)}const u={};a>1&&(u.colspan=a),pe(c,s,l+1,d,1,u);const h=s.getAttribute("headingRows")||0;h>l&&T("headingRows",h+d,s,c)}})}getColumns(t){return[...t.getChild(0).getChildren()].filter(n=>n.is("element","tableCell")).reduce((n,o)=>{const s=parseInt(o.getAttribute("colspan")||"1");return n+s},0)}getRows(t){return Array.from(t.getChildren()).reduce((e,n)=>n.is("element","tableRow")?e+1:e,0)}createTableWalker(t,e={}){return new k(t,e)}getSelectedTableCells(t){const e=[];for(const n of this.sortRanges(t.getRanges())){const o=n.getContainedElement();o&&o.is("element","tableCell")&&e.push(o)}return e}getTableCellsContainingSelection(t){const e=[];for(const n of t.getRanges()){const o=n.start.findAncestor("tableCell");o&&e.push(o)}return e}getSelectionAffectedTableCells(t){const e=this.getSelectedTableCells(t);return e.length?e:this.getTableCellsContainingSelection(t)}getRowIndexes(t){const e=t.map(n=>n.parent.index);return this._getFirstLastIndexesObject(e)}getColumnIndexes(t){const e=t[0].findAncestor("table"),o=[...new k(e)].filter(s=>t.includes(s.cell)).map(s=>s.column);return this._getFirstLastIndexesObject(o)}isSelectionRectangular(t){if(t.length<2||!this._areCellInTheSameTableSection(t))return!1;const e=new Set,n=new Set;let o=0;for(const l of t){const{row:r,column:a}=this.getCellLocation(l),c=parseInt(l.getAttribute("rowspan"))||1,d=parseInt(l.getAttribute("colspan"))||1;e.add(r),n.add(a),c>1&&e.add(r+c-1),d>1&&n.add(a+d-1),o+=c*d}return Zi(e,n)==o}sortRanges(t){return Array.from(t).sort(Yi)}_getFirstLastIndexesObject(t){const e=t.sort((s,l)=>s-l),n=e[0],o=e[e.length-1];return{first:n,last:o}}_areCellInTheSameTableSection(t){const e=t[0].findAncestor("table"),n=this.getRowIndexes(t),o=parseInt(e.getAttribute("headingRows"))||0;if(!this._areIndexesInSameSection(n,o))return!1;const s=this.getColumnIndexes(t),l=parseInt(e.getAttribute("headingColumns"))||0;return this._areIndexesInSameSection(s,l)}_areIndexesInSameSection({first:t,last:e},n){const o=t<n,s=e<n;return o===s}}function pe(i,t,e,n,o,s={}){for(let l=0;l<n;l++){const r=i.createElement("tableRow");i.insert(r,t,e),z(o,i,i.createPositionAt(r,"end"),s)}}function z(i,t,e,n={}){for(let o=0;o<i;o++)N(t,e,n)}function at(i,t){if(i<t)return{newCellsSpan:1,updatedSpan:1};const e=Math.floor(i/t),n=i-e*t+e;return{newCellsSpan:e,updatedSpan:n}}function qi(i,t,e){const n=i.getAttribute("headingColumns")||0;if(n&&t.first<n){const o=Math.min(n-1,t.last)-t.first+1;e.setAttribute("headingColumns",n-o,i)}}function ji(i,{first:t,last:e},n){const o=i.getAttribute("headingRows")||0;if(t<o){const s=e<o?o-(e-t+1):t;T("headingRows",s,i,n,0)}}function Gi(i,{first:t,last:e}){const n=new Map,o=[];for(const{row:s,column:l,cellHeight:r,cell:a}of new k(i,{endRow:e})){const c=s+r-1;if(s>=t&&s<=e&&c>e){const u=e-s+1,h=r-u;n.set(l,{cell:a,rowspan:h})}if(s<t&&c>=t){let u;c>=e?u=e-t+1:u=c-t+1,o.push({cell:a,rowspan:r-u})}}return{cellsToMove:n,cellsToTrim:o}}function Ji(i,t,e,n){const s=[...new k(i,{includeAllSlots:!0,row:t})],l=i.getChild(t);let r;for(const{column:a,cell:c,isAnchor:d}of s)if(e.has(a)){const{cell:m,rowspan:u}=e.get(a),h=r?n.createPositionAfter(r):n.createPositionAt(l,0);n.move(n.createRangeOn(m),h),T("rowspan",u,m,n),r=m}else d&&(r=c)}function Yi(i,t){const e=i.start,n=t.start;return e.isBefore(n)?-1:1}function Zi(i,t){const e=Array.from(i.values()),n=Array.from(t.values()),o=Math.max(...e),s=Math.min(...e),l=Math.max(...n),r=Math.min(...n);return(o-s+1)*(l-r+1)}class Xi extends I{refresh(){const t=this.editor.plugins.get(_),e=t.getSelectedTableCells(this.editor.model.document.selection);this.isEnabled=t.isSelectionRectangular(e)}execute(){const t=this.editor.model,e=this.editor.plugins.get(_);t.change(n=>{const o=e.getSelectedTableCells(t.document.selection),s=o.shift(),{mergeWidth:l,mergeHeight:r}=el(s,o,e);T("colspan",l,s,n),T("rowspan",r,s,n);for(const c of o)Qi(c,s,n);const a=s.findAncestor("table");He(a,e),n.setSelection(s,"in")})}}function Qi(i,t,e){ct(i)||(ct(t)&&e.remove(e.createRangeIn(t)),e.move(e.createRangeIn(i),e.createPositionAt(t,"end"))),e.remove(i)}function ct(i){const t=i.getChild(0);return i.childCount==1&&t.is("element","paragraph")&&t.isEmpty}function el(i,t,e){let n=0,o=0;for(const c of t){const{row:d,column:m}=e.getCellLocation(c);n=dt(c,m,n,"colspan"),o=dt(c,d,o,"rowspan")}const{row:s,column:l}=e.getCellLocation(i),r=n-l,a=o-s;return{mergeWidth:r,mergeHeight:a}}function dt(i,t,e,n){const o=parseInt(i.getAttribute(n)||"1");return Math.max(e,t+o)}class tl extends I{constructor(t){super(t),this.affectsData=!1}refresh(){const e=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){const t=this.editor.model,e=this.editor.plugins.get("TableUtils"),n=e.getSelectionAffectedTableCells(t.document.selection),o=e.getRowIndexes(n),s=n[0].findAncestor("table"),l=[];for(let r=o.first;r<=o.last;r++)for(const a of s.getChild(r).getChildren())l.push(t.createRangeOn(a));t.change(r=>{r.setSelection(l)})}}class nl extends I{constructor(t){super(t),this.affectsData=!1}refresh(){const e=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){const t=this.editor.plugins.get("TableUtils"),e=this.editor.model,n=t.getSelectionAffectedTableCells(e.document.selection),o=n[0],s=n.pop(),l=o.findAncestor("table"),r=t.getCellLocation(o),a=t.getCellLocation(s),c=Math.min(r.column,a.column),d=Math.max(r.column,a.column),m=[];for(const u of new k(l,{startColumn:c,endColumn:d}))m.push(e.createRangeOn(u.cell));e.change(u=>{u.setSelection(m)})}}function ol(i){i.document.registerPostFixer(t=>sl(t,i))}function sl(i,t){const e=t.document.differ.getChanges();let n=!1;const o=new Set;for(const s of e){let l=null;s.type=="insert"&&s.name=="table"&&(l=s.position.nodeAfter),(s.type=="insert"||s.type=="remove")&&(s.name=="tableRow"||s.name=="tableCell")&&(l=s.position.findAncestor("table")),cl(s)&&(l=s.range.start.findAncestor("table")),l&&!o.has(l)&&(n=il(l,i)||n,n=ll(l,i)||n,o.add(l))}return n}function il(i,t){let e=!1;const n=rl(i);if(n.length){e=!0;for(const o of n)T("rowspan",o.rowspan,o.cell,t,1)}return e}function ll(i,t){let e=!1;const n=al(i),o=[];for(const[a,c]of n.entries())!c&&i.getChild(a).is("element","tableRow")&&o.push(a);if(o.length){e=!0;for(const a of o.reverse())t.remove(i.getChild(a)),n.splice(a,1)}const s=n.filter((a,c)=>i.getChild(c).is("element","tableRow")),l=s[0];if(!s.every(a=>a===l)){const a=s.reduce((c,d)=>d>c?d:c,0);for(const[c,d]of s.entries()){const m=a-d;if(m){for(let u=0;u<m;u++)N(t,t.createPositionAt(i.getChild(c),"end"));e=!0}}}return e}function rl(i){const t=parseInt(i.getAttribute("headingRows")||"0"),e=Array.from(i.getChildren()).reduce((o,s)=>s.is("element","tableRow")?o+1:o,0),n=[];for(const{row:o,cell:s,cellHeight:l}of new k(i)){if(l<2)continue;const a=o<t?t:e;if(o+l>a){const c=a-o;n.push({cell:s,rowspan:c})}}return n}function al(i){const t=new Array(i.childCount).fill(0);for(const{rowIndex:e}of new k(i,{includeAllSlots:!0}))t[e]++;return t}function cl(i){if(i.type!=="attribute")return!1;const t=i.attributeKey;return t==="headingRows"||t==="colspan"||t==="rowspan"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function dl(i){i.document.registerPostFixer(t=>ul(t,i))}function ul(i,t){const e=t.document.differ.getChanges();let n=!1;for(const o of e)o.type=="insert"&&o.name=="table"&&(n=ml(o.position.nodeAfter,i)||n),o.type=="insert"&&o.name=="tableRow"&&(n=dn(o.position.nodeAfter,i)||n),o.type=="insert"&&o.name=="tableCell"&&(n=Ae(o.position.nodeAfter,i)||n),(o.type=="remove"||o.type=="insert")&&hl(o)&&(n=Ae(o.position.parent,i)||n);return n}function ml(i,t){let e=!1;for(const n of i.getChildren())n.is("element","tableRow")&&(e=dn(n,t)||e);return e}function dn(i,t){let e=!1;for(const n of i.getChildren())e=Ae(n,t)||e;return e}function Ae(i,t){if(i.childCount==0)return t.insertElement("paragraph",i),!0;const e=Array.from(i.getChildren()).filter(n=>n.is("$text"));for(const n of e)t.wrap(t.createRangeOn(n),"paragraph");return!!e.length}function hl(i){return i.position.parent.is("element","tableCell")?i.type=="insert"&&i.name=="$text"||i.type=="remove":!1}function gl(i,t){const e=i.document.differ;for(const n of e.getChanges()){let o,s=!1;if(n.type=="attribute"){const c=n.range.start.nodeAfter;if(!c||!c.is("element","table")||n.attributeKey!="headingRows"&&n.attributeKey!="headingColumns")continue;o=c,s=n.attributeKey=="headingRows"}else(n.name=="tableRow"||n.name=="tableCell")&&(o=n.position.findAncestor("table"),s=n.name=="tableRow");if(!o)continue;const l=o.getAttribute("headingRows")||0,r=o.getAttribute("headingColumns")||0,a=new k(o);for(const c of a){const m=c.row<l||c.column<r?"th":"td",u=t.mapper.toViewElement(c.cell);u&&u.is("element")&&u.name!=m&&t.reconvertItem(s?c.cell.parent:c.cell)}}}function fl(i,t){const e=i.document.differ,n=new Set;for(const o of e.getChanges()){const s=o.type=="attribute"?o.range.start.parent:o.position.parent;s.is("element","tableCell")&&n.add(s)}for(const o of n.values()){const s=Array.from(o.getChildren()).filter(l=>pl(l,t.mapper));for(const l of s)t.reconvertItem(l)}}function pl(i,t){if(!i.is("element","paragraph"))return!1;const e=t.toViewElement(i);return e?en(i)!==e.is("element","span"):!1}class bl extends C{constructor(e){super(e);g(this,"_additionalSlots");this._additionalSlots=[]}static get pluginName(){return"TableEditing"}static get requires(){return[_]}init(){const e=this.editor,n=e.model,o=n.schema,s=e.conversion,l=e.plugins.get(_);o.register("table",{inheritAllFrom:"$blockObject",allowAttributes:["headingRows","headingColumns"]}),o.register("tableRow",{allowIn:"table",isLimit:!0}),o.register("tableCell",{allowContentOf:"$container",allowIn:"tableRow",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),s.for("upcast").add(ki()),s.for("upcast").add(Ii()),s.for("editingDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:tt(l,{asWidget:!0,additionalSlots:this._additionalSlots})}),s.for("dataDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:tt(l,{additionalSlots:this._additionalSlots})}),s.for("upcast").elementToElement({model:"tableRow",view:"tr"}),s.for("upcast").add(Ti()),s.for("downcast").elementToElement({model:"tableRow",view:Ri()}),s.for("upcast").elementToElement({model:"tableCell",view:"td"}),s.for("upcast").elementToElement({model:"tableCell",view:"th"}),s.for("upcast").add(et("td")),s.for("upcast").add(et("th")),s.for("editingDowncast").elementToElement({model:"tableCell",view:nt({asWidget:!0})}),s.for("dataDowncast").elementToElement({model:"tableCell",view:nt()}),s.for("editingDowncast").elementToElement({model:"paragraph",view:ot({asWidget:!0}),converterPriority:"high"}),s.for("dataDowncast").elementToElement({model:"paragraph",view:ot(),converterPriority:"high"}),s.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),s.for("upcast").attributeToAttribute({model:{key:"colspan",value:ut("colspan")},view:"colspan"}),s.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),s.for("upcast").attributeToAttribute({model:{key:"rowspan",value:ut("rowspan")},view:"rowspan"}),e.config.define("table.defaultHeadings.rows",0),e.config.define("table.defaultHeadings.columns",0),e.commands.add("insertTable",new Vi(e)),e.commands.add("insertTableRowAbove",new st(e,{order:"above"})),e.commands.add("insertTableRowBelow",new st(e,{order:"below"})),e.commands.add("insertTableColumnLeft",new it(e,{order:"left"})),e.commands.add("insertTableColumnRight",new it(e,{order:"right"})),e.commands.add("removeTableRow",new Ui(e)),e.commands.add("removeTableColumn",new Ni(e)),e.commands.add("splitTableCellVertically",new lt(e,{direction:"vertically"})),e.commands.add("splitTableCellHorizontally",new lt(e,{direction:"horizontally"})),e.commands.add("mergeTableCells",new Xi(e)),e.commands.add("mergeTableCellRight",new X(e,{direction:"right"})),e.commands.add("mergeTableCellLeft",new X(e,{direction:"left"})),e.commands.add("mergeTableCellDown",new X(e,{direction:"down"})),e.commands.add("mergeTableCellUp",new X(e,{direction:"up"})),e.commands.add("setTableColumnHeader",new Wi(e)),e.commands.add("setTableRowHeader",new zi(e)),e.commands.add("selectTableRow",new tl(e)),e.commands.add("selectTableColumn",new nl(e)),ol(n),dl(n),this.listenTo(n.document,"change:data",()=>{gl(n,e.editing),fl(n,e.editing)})}registerAdditionalSlot(e){this._additionalSlots.push(e)}}function ut(i){return t=>{const e=parseInt(t.getAttribute(i));return Number.isNaN(e)||e<=0?null:e}}class mt extends ${constructor(e){super(e);g(this,"items");g(this,"keystrokes");g(this,"focusTracker");const n=this.bindTemplate;this.items=this._createGridCollection(),this.keystrokes=new G,this.focusTracker=new j,this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(o,s)=>`${s}  ${o}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":n.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck","ck-insert-table-dropdown__label"],"aria-hidden":!0},children:[{text:n.to("label")}]}],on:{mousedown:n.to(o=>{o.preventDefault()}),click:n.to(()=>{this.fire("execute")})}}),this.on("boxover",(o,s)=>{const{row:l,column:r}=s.target.dataset;this.items.get((parseInt(l,10)-1)*10+(parseInt(r,10)-1)).focus()}),this.focusTracker.on("change:focusedElement",(o,s,l)=>{if(!l)return;const{row:r,column:a}=l.dataset;this.set({rows:parseInt(r),columns:parseInt(a)})}),this.on("change:columns",()=>this._highlightGridBoxes()),this.on("change:rows",()=>this._highlightGridBoxes())}render(){super.render(),Zn({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:10,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection});for(const e of this.items)this.focusTracker.add(e.element);this.keystrokes.listenTo(this.element)}reset(){this.set({rows:1,columns:1})}focus(){this.items.get(0).focus()}focusLast(){this.items.get(0).focus()}_highlightGridBoxes(){const e=this.rows,n=this.columns;this.items.map((o,s)=>{const l=Math.floor(s/10),r=s%10,a=l<e&&r<n;o.set("isOn",a)})}_createGridButton(e,n,o,s){const l=new x(e);return l.set({label:s,class:"ck-insert-table-dropdown-grid-box"}),l.extendTemplate({attributes:{"data-row":n,"data-column":o}}),l}_createGridCollection(){const e=[];for(let n=0;n<100;n++){const o=Math.floor(n/10),s=n%10,l=`${o+1}  ${s+1}`;e.push(this._createGridButton(this.locale,o+1,s+1,l))}return this.createCollection(e)}}var wl='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M18 7v1H2V7h16zm0 5v1H2v-1h16z" opacity=".6"/><path d="M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z"/></svg>',Cl='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v16h-1V2z" opacity=".6"/><path d="M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z"/></svg>',vl='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z" opacity=".6"/><path d="M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z"/></svg>';class kl extends C{static get pluginName(){return"TableUI"}init(){const t=this.editor,e=this.editor.t,o=t.locale.contentLanguageDirection==="ltr";t.ui.componentFactory.add("insertTable",s=>{const l=t.commands.get("insertTable"),r=F(s);r.bind("isEnabled").to(l),r.buttonView.set({icon:S.table,label:e("Insert table"),tooltip:!0});let a;return r.on("change:isOpen",()=>{a||(a=new mt(s),r.panelView.children.add(a),a.delegate("execute").to(r),r.on("execute",()=>{t.execute("insertTable",{rows:a.rows,columns:a.columns}),t.editing.view.focus()}))}),r}),t.ui.componentFactory.add("menuBar:insertTable",s=>{const l=t.commands.get("insertTable"),r=new K(s),a=new mt(s);return a.delegate("execute").to(r),r.on("change:isOpen",(c,d,m)=>{m||a.reset()}),a.on("execute",()=>{t.execute("insertTable",{rows:a.rows,columns:a.columns}),t.editing.view.focus()}),r.buttonView.set({label:e("Table"),icon:S.table}),r.panelView.children.add(a),r.bind("isEnabled").to(l),r}),t.ui.componentFactory.add("tableColumn",s=>{const l=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:e("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:o?"insertTableColumnLeft":"insertTableColumnRight",label:e("Insert column left")}},{type:"button",model:{commandName:o?"insertTableColumnRight":"insertTableColumnLeft",label:e("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:e("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:e("Select column")}}];return this._prepareDropdown(e("Column"),wl,l,s)}),t.ui.componentFactory.add("tableRow",s=>{const l=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:e("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:e("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:e("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:e("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:e("Select row")}}];return this._prepareDropdown(e("Row"),Cl,l,s)}),t.ui.componentFactory.add("mergeTableCells",s=>{const l=[{type:"button",model:{commandName:"mergeTableCellUp",label:e("Merge cell up")}},{type:"button",model:{commandName:o?"mergeTableCellRight":"mergeTableCellLeft",label:e("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:e("Merge cell down")}},{type:"button",model:{commandName:o?"mergeTableCellLeft":"mergeTableCellRight",label:e("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:e("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:e("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(e("Merge cells"),vl,l,s)})}_prepareDropdown(t,e,n,o){const s=this.editor,l=F(o),r=this._fillDropdownWithListOptions(l,n);return l.buttonView.set({label:t,icon:e,tooltip:!0}),l.bind("isEnabled").toMany(r,"isEnabled",(...a)=>a.some(c=>c)),this.listenTo(l,"execute",a=>{s.execute(a.source.commandName),a.source instanceof Tt||s.editing.view.focus()}),l}_prepareMergeSplitButtonDropdown(t,e,n,o){const s=this.editor,l=F(o,pt),r="mergeTableCells",a=s.commands.get(r),c=this._fillDropdownWithListOptions(l,n);return l.buttonView.set({label:t,icon:e,tooltip:!0,isEnabled:!0}),l.bind("isEnabled").toMany([a,...c],"isEnabled",(...d)=>d.some(m=>m)),this.listenTo(l.buttonView,"execute",()=>{s.execute(r),s.editing.view.focus()}),this.listenTo(l,"execute",d=>{s.execute(d.source.commandName),s.editing.view.focus()}),l}_fillDropdownWithListOptions(t,e){const n=this.editor,o=[],s=new q;for(const l of e)Il(l,n,o,s);return oe(t,s),o}}function Il(i,t,e,n){if(i.type==="button"||i.type==="switchbutton"){const o=i.model=new le(i.model),{commandName:s,bindIsOn:l}=i.model,r=t.commands.get(s);e.push(r),o.set({commandName:s}),o.bind("isEnabled").to(r),l&&o.bind("isOn").to(r,"value"),o.set({withText:!0})}n.add(i)}class H extends C{static get pluginName(){return"TableSelection"}static get requires(){return[_,_]}init(){const t=this.editor,e=t.model,n=t.editing.view;this.listenTo(e,"deleteContent",(o,s)=>this._handleDeleteContent(o,s),{priority:"high"}),this.listenTo(n.document,"insertText",(o,s)=>this._handleInsertTextEvent(o,s),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){const t=this.editor.plugins.get(_),e=this.editor.model.document.selection,n=t.getSelectedTableCells(e);return n.length==0?null:n}getSelectionAsFragment(){const t=this.editor.plugins.get(_),e=this.getSelectedTableCells();return e?this.editor.model.change(n=>{const o=n.createDocumentFragment(),{first:s,last:l}=t.getColumnIndexes(e),{first:r,last:a}=t.getRowIndexes(e),c=e[0].findAncestor("table");let d=a,m=l;if(t.isSelectionRectangular(e)){const f={firstColumn:s,lastColumn:l,firstRow:r,lastRow:a};d=an(c,f),m=cn(c,f)}const h=tn(c,{startRow:r,startColumn:s,endRow:d,endColumn:m},n);return n.insert(h,o,0),o}):null}setCellSelection(t,e){const n=this._getCellsToSelect(t,e);this.editor.model.change(o=>{o.setSelection(n.cells.map(s=>o.createRangeOn(s)),{backward:n.backward})})}getFocusCell(){const n=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return n&&n.is("element","tableCell")?n:null}getAnchorCell(){const t=this.editor.model.document.selection,n=U(t.getRanges()).getContainedElement();return n&&n.is("element","tableCell")?n:null}_defineSelectionConverter(){const t=this.editor,e=new Set;t.conversion.for("editingDowncast").add(o=>o.on("selection",(s,l,r)=>{const a=r.writer;n(a);const c=this.getSelectedTableCells();if(!c)return;for(const m of c){const u=r.mapper.toViewElement(m);a.addClass("ck-editor__editable_selected",u),e.add(u)}const d=r.mapper.toViewElement(c[c.length-1]);a.setSelection(d,0)},{priority:"lowest"}));function n(o){for(const s of e)o.removeClass("ck-editor__editable_selected",s);e.clear()}}_enablePluginDisabling(){const t=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){const e=this.getSelectedTableCells();if(!e)return;t.model.change(n=>{const o=n.createPositionAt(e[0],0),s=t.model.schema.getNearestSelectionRange(o);n.setSelection(s)})}})}_handleDeleteContent(t,e){const n=this.editor.plugins.get(_),o=e[0],s=e[1],l=this.editor.model,r=!s||s.direction=="backward",a=n.getSelectedTableCells(o);a.length&&(t.stop(),l.change(c=>{const d=a[r?a.length-1:0];l.change(u=>{for(const h of a)l.deleteContent(u.createSelection(h,"in"))});const m=l.schema.getNearestSelectionRange(c.createPositionAt(d,0));o.is("documentSelection")?c.setSelection(m):o.setTo(m)}))}_handleInsertTextEvent(t,e){const n=this.editor,o=this.getSelectedTableCells();if(!o)return;const s=n.editing.view,l=n.editing.mapper,r=o.map(a=>s.createRangeOn(l.toViewElement(a)));e.selection=s.createSelection(r)}_getCellsToSelect(t,e){const n=this.editor.plugins.get("TableUtils"),o=n.getCellLocation(t),s=n.getCellLocation(e),l=Math.min(o.row,s.row),r=Math.max(o.row,s.row),a=Math.min(o.column,s.column),c=Math.max(o.column,s.column),d=new Array(r-l+1).fill(null).map(()=>[]),m={startRow:l,endRow:r,startColumn:a,endColumn:c};for(const{row:f,cell:p}of new k(t.findAncestor("table"),m))d[f-l].push(p);const u=s.row<o.row,h=s.column<o.column;return u&&d.reverse(),h&&d.forEach(f=>f.reverse()),{cells:d.flat(),backward:u||h}}}class Tl extends C{static get pluginName(){return"TableClipboard"}static get requires(){return[me,re,H,_]}init(){const t=this.editor,e=t.editing.view.document;this.listenTo(e,"copy",(n,o)=>this._onCopyCut(n,o)),this.listenTo(e,"cut",(n,o)=>this._onCopyCut(n,o)),this.listenTo(t.model,"insertContent",(n,[o,s])=>this._onInsertContent(n,o,s),{priority:"high"}),this.decorate("_replaceTableSlotCell")}_onCopyCut(t,e){const n=this.editor.editing.view,o=this.editor.plugins.get(H),s=this.editor.plugins.get(me);o.getSelectedTableCells()&&(t.name=="cut"&&!this.editor.model.canEditAt(this.editor.model.document.selection)||(e.preventDefault(),t.stop(),this.editor.model.enqueueChange({isUndoable:t.name==="cut"},()=>{const l=s._copySelectedFragmentWithMarkers(t.name,this.editor.model.document.selection,()=>o.getSelectionAsFragment());n.document.fire("clipboardOutput",{dataTransfer:e.dataTransfer,content:this.editor.data.toView(l),method:t.name})})))}_onInsertContent(t,e,n){if(n&&!n.is("documentSelection"))return;const o=this.editor.model,s=this.editor.plugins.get(_),l=this.editor.plugins.get(me),r=this.getTableIfOnlyTableInContent(e,o);if(!r)return;const a=s.getSelectionAffectedTableCells(o.document.selection);if(!a.length){He(r,s);return}t.stop(),e.is("documentFragment")?l._pasteMarkersIntoTransformedElement(e.markers,c=>this._replaceSelectedCells(r,a,c)):this.editor.model.change(c=>{this._replaceSelectedCells(r,a,c)})}_replaceSelectedCells(t,e,n){const o=this.editor.plugins.get(_),s={width:o.getColumns(t),height:o.getRows(t)},l=_l(e,s,n,o),r=l.lastRow-l.firstRow+1,a=l.lastColumn-l.firstColumn+1,c={startRow:0,startColumn:0,endRow:Math.min(r,s.height)-1,endColumn:Math.min(a,s.width)-1};t=tn(t,c,n);const d=e[0].findAncestor("table"),m=this._replaceSelectedCellsWithPasted(t,s,d,l,n);if(this.editor.plugins.get("TableSelection").isEnabled){const u=o.sortRanges(m.map(h=>n.createRangeOn(h)));n.setSelection(u)}else n.setSelection(m[0],0);return d}_replaceSelectedCellsWithPasted(t,e,n,o,s){const{width:l,height:r}=e,a=Al(t,l,r),c=[...new k(n,{startRow:o.firstRow,endRow:o.lastRow,startColumn:o.firstColumn,endColumn:o.lastColumn,includeAllSlots:!0})],d=[];let m;for(const w of c){const{row:b,column:v}=w;v===o.firstColumn&&(m=w.getPositionBefore());const R=b-o.firstRow,P=v-o.firstColumn,J=a[R%r][P%l],ue=J?s.cloneElement(J):null,Y=this._replaceTableSlotCell(w,ue,m,s);Y&&(rn(Y,b,v,o.lastRow,o.lastColumn,s),d.push(Y),m=s.createPositionAfter(Y))}const u=parseInt(n.getAttribute("headingRows")||"0"),h=parseInt(n.getAttribute("headingColumns")||"0"),f=o.firstRow<u&&u<=o.lastRow,p=o.firstColumn<h&&h<=o.lastColumn;if(f){const w={first:o.firstColumn,last:o.lastColumn},b=Se(n,u,w,s,o.firstRow);d.push(...b)}if(p){const w={first:o.firstRow,last:o.lastRow},b=Re(n,h,w,s);d.push(...b)}return d}_replaceTableSlotCell(t,e,n,o){const{cell:s,isAnchor:l}=t;return l&&o.remove(s),e?(o.insert(e,n),e):null}getTableIfOnlyTableInContent(t,e){if(!t.is("documentFragment")&&!t.is("element"))return null;if(t.is("element","table"))return t;if(t.childCount==1&&t.getChild(0).is("element","table"))return t.getChild(0);const n=e.createRangeIn(t);for(const o of n.getItems())if(o.is("element","table")){const s=e.createRange(n.start,e.createPositionBefore(o));if(e.hasContent(s,{ignoreWhitespaces:!0}))return null;const l=e.createRange(e.createPositionAfter(o),n.end);return e.hasContent(l,{ignoreWhitespaces:!0})?null:o}return null}}function _l(i,t,e,n){const o=i[0].findAncestor("table"),s=n.getColumnIndexes(i),l=n.getRowIndexes(i),r={firstColumn:s.first,lastColumn:s.last,firstRow:l.first,lastRow:l.last},a=i.length===1;return a&&(r.lastRow+=t.height-1,r.lastColumn+=t.width-1,yl(o,r.lastRow+1,r.lastColumn+1,n)),a||!n.isSelectionRectangular(i)?Sl(o,r,e):(r.lastRow=an(o,r),r.lastColumn=cn(o,r)),r}function yl(i,t,e,n){const o=n.getColumns(i),s=n.getRows(i);e>o&&n.insertColumns(i,{at:o,columns:e-o}),t>s&&n.insertRows(i,{at:s,rows:t-s})}function Al(i,t,e){const n=new Array(e).fill(null).map(()=>new Array(t).fill(null));for(const{column:o,row:s,cell:l}of new k(i))n[s][o]=l;return n}function Sl(i,t,e){const{firstRow:n,lastRow:o,firstColumn:s,lastColumn:l}=t,r={first:n,last:o},a={first:s,last:l};Re(i,s,r,e),Re(i,l+1,r,e),Se(i,n,a,e),Se(i,o+1,a,e,n)}function Se(i,t,e,n,o=0){return t<1?void 0:nn(i,t,o).filter(({column:r,cellWidth:a})=>un(r,a,e)).map(({cell:r})=>on(r,t,n))}function Re(i,t,e,n){return t<1?void 0:sn(i,t).filter(({row:l,cellHeight:r})=>un(l,r,e)).map(({cell:l,column:r})=>ln(l,r,t,n))}function un(i,t,e){const n=i+t-1,{first:o,last:s}=e,l=i>=o&&i<=s,r=i<o&&n>=o;return l||r}class Rl extends C{static get pluginName(){return"TableKeyboard"}static get requires(){return[H,_]}init(){const t=this.editor,n=t.editing.view.document,o=t.t;this.listenTo(n,"arrowKey",(...s)=>this._onArrowKey(...s),{context:"table"}),this.listenTo(n,"tab",(...s)=>this._handleTabOnSelectedTable(...s),{context:"figure"}),this.listenTo(n,"tab",(...s)=>this._handleTab(...s),{context:["th","td"]}),t.accessibility.addKeystrokeInfoGroup({id:"table",label:o("Keystrokes that can be used in a table cell"),keystrokes:[{label:o("Move the selection to the next cell"),keystroke:"Tab"},{label:o("Move the selection to the previous cell"),keystroke:"Shift+Tab"},{label:o("Insert a new table row (when in the last cell of a table)"),keystroke:"Tab"},{label:o("Navigate through the table"),keystroke:[["arrowup"],["arrowright"],["arrowdown"],["arrowleft"]]}]})}_handleTabOnSelectedTable(t,e){const n=this.editor,s=n.model.document.selection.getSelectedElement();!s||!s.is("element","table")||(e.preventDefault(),e.stopPropagation(),t.stop(),n.model.change(l=>{l.setSelection(l.createRangeIn(s.getChild(0).getChild(0)))}))}_handleTab(t,e){const n=this.editor,o=this.editor.plugins.get(_),s=this.editor.plugins.get("TableSelection"),l=n.model.document.selection,r=!e.shiftKey;let a=o.getTableCellsContainingSelection(l)[0];if(a||(a=s.getFocusCell()),!a)return;e.preventDefault(),e.stopPropagation(),t.stop();const c=a.parent,d=c.parent,m=d.getChildIndex(c),u=c.getChildIndex(a),h=u===0;if(!r&&h&&m===0){n.model.change(b=>{b.setSelection(b.createRangeOn(d))});return}const f=u===c.childCount-1,p=m===o.getRows(d)-1;if(r&&p&&f&&(n.execute("insertTableRowBelow"),m===o.getRows(d)-1)){n.model.change(b=>{b.setSelection(b.createRangeOn(d))});return}let w;if(r&&f)w=d.getChild(m+1).getChild(0);else if(!r&&h){const b=d.getChild(m-1);w=b.getChild(b.childCount-1)}else w=c.getChild(u+(r?1:-1));n.model.change(b=>{b.setSelection(b.createRangeIn(w))})}_onArrowKey(t,e){const n=this.editor,o=e.keyCode,s=Jn(o,n.locale.contentLanguageDirection);this._handleArrowKeys(s,e.shiftKey)&&(e.preventDefault(),e.stopPropagation(),t.stop())}_handleArrowKeys(t,e){const n=this.editor.plugins.get(_),o=this.editor.plugins.get("TableSelection"),s=this.editor.model,l=s.document.selection,r=["right","down"].includes(t),a=n.getSelectedTableCells(l);if(a.length){let d;return e?d=o.getFocusCell():d=r?a[a.length-1]:a[0],this._navigateFromCellInDirection(d,t,e),!0}const c=l.focus.findAncestor("tableCell");/* istanbul ignore if: paranoid check -- @preserve */if(!c)return!1;if(!l.isCollapsed)if(e){if(l.isBackward==r&&!l.containsEntireContent(c))return!1}else{const d=l.getSelectedElement();if(!d||!s.schema.isObject(d))return!1}return this._isSelectionAtCellEdge(l,c,r)?(this._navigateFromCellInDirection(c,t,e),!0):!1}_isSelectionAtCellEdge(t,e,n){const o=this.editor.model,s=this.editor.model.schema,l=n?t.getLastPosition():t.getFirstPosition();if(!s.getLimitElement(l).is("element","tableCell"))return o.createPositionAt(e,n?"end":0).isTouching(l);const r=o.createSelection(l);return o.modifySelection(r,{direction:n?"forward":"backward"}),l.isEqual(r.focus)}_navigateFromCellInDirection(t,e,n=!1){const o=this.editor.model,s=t.findAncestor("table"),l=[...new k(s,{includeAllSlots:!0})],{row:r,column:a}=l[l.length-1],c=l.find(({cell:v})=>v==t);let{row:d,column:m}=c;switch(e){case"left":m--;break;case"up":d--;break;case"right":m+=c.cellWidth;break;case"down":d+=c.cellHeight;break}const u=d<0||d>r,h=m<0&&d<=0,f=m>a&&d>=r;if(u||h||f){o.change(v=>{v.setSelection(v.createRangeOn(s))});return}m<0?(m=n?0:a,d--):m>a&&(m=n?a:0,d++);const p=l.find(v=>v.row==d&&v.column==m).cell,w=["right","down"].includes(e),b=this.editor.plugins.get("TableSelection");if(n&&b.isEnabled){const v=b.getAnchorCell()||t;b.setCellSelection(v,p)}else{const v=o.createPositionAt(p,w?0:"end");o.change(R=>{R.setSelection(v)})}}}class xl extends Xn{constructor(){super(...arguments);g(this,"domEventType",["mousemove","mouseleave"])}onDomEvent(e){this.fire(e.type,e)}}class El extends C{static get pluginName(){return"TableMouse"}static get requires(){return[H,_]}init(){this.editor.editing.view.addObserver(xl),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){const t=this.editor,e=t.plugins.get(_);let n=!1;const o=t.plugins.get(H);this.listenTo(t.editing.view.document,"mousedown",(s,l)=>{const r=t.model.document.selection;if(!this.isEnabled||!o.isEnabled||!l.domEvent.shiftKey)return;const a=o.getAnchorCell()||e.getTableCellsContainingSelection(r)[0];if(!a)return;const c=this._getModelTableCellFromDomEvent(l);c&&ht(a,c)&&(n=!0,o.setCellSelection(a,c),l.preventDefault())}),this.listenTo(t.editing.view.document,"mouseup",()=>{n=!1}),this.listenTo(t.editing.view.document,"selectionChange",s=>{n&&s.stop()},{priority:"highest"})}_enableMouseDragSelection(){const t=this.editor;let e,n,o=!1,s=!1;const l=t.plugins.get(H);this.listenTo(t.editing.view.document,"mousedown",(r,a)=>{!this.isEnabled||!l.isEnabled||a.domEvent.shiftKey||a.domEvent.ctrlKey||a.domEvent.altKey||(e=this._getModelTableCellFromDomEvent(a))}),this.listenTo(t.editing.view.document,"mousemove",(r,a)=>{if(!a.domEvent.buttons||!e)return;const c=this._getModelTableCellFromDomEvent(a);c&&ht(e,c)&&(n=c,!o&&n!=e&&(o=!0)),o&&(s=!0,l.setCellSelection(e,n),a.preventDefault())}),this.listenTo(t.editing.view.document,"mouseup",()=>{o=!1,s=!1,e=null,n=null}),this.listenTo(t.editing.view.document,"selectionChange",r=>{s&&r.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(t){const e=t.target,n=this.editor.editing.view.createPositionAt(e,0);return this.editor.editing.mapper.toModelPosition(n).parent.findAncestor("tableCell",{includeSelf:!0})}}function ht(i,t){return i.parent.parent==t.parent.parent}class zl extends C{static get requires(){return[bl,kl,H,El,Rl,Tl,xe]}static get pluginName(){return"Table"}}function Vl(i){const t=i.getSelectedElement();return t&&mn(t)?t:null}function Bl(i){const t=i.getFirstPosition();if(!t)return null;let e=t.parent;for(;e;){if(e.is("element")&&mn(e))return e;e=e.parent}return null}function mn(i){return!!i.getCustomProperty("table")&&Ee(i)}class Wl extends C{static get requires(){return[Oe]}static get pluginName(){return"TableToolbar"}afterInit(){const t=this.editor,e=t.t,n=t.plugins.get(Oe),o=t.config.get("table.contentToolbar"),s=t.config.get("table.tableToolbar");o&&n.register("tableContent",{ariaLabel:e("Table toolbar"),items:o,getRelatedElement:Bl}),s&&n.register("table",{ariaLabel:e("Table toolbar"),items:s,getRelatedElement:Vl})}}export{Pl as B,Ul as E,Ol as F,Nl as H,Hl as I,Dl as L,ke as P,zl as T,Wo as U,Ml as a,Wl as b};
